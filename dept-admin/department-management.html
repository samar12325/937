<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-ar="بلاغات 937" - ادارة القسم data-en="Department Management">بلاغات 937 — ادارة القسم</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Reuse dashboard/admin styling -->
  <link rel="stylesheet" href="dept-admin.css">

  <style>
    /* Header and back button styles */
    .header {
      position: relative;
    }
    
    .btn-back{
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: #6b7280; 
      color: #fff; 
      border: none; 
      border-radius: 8px;
      padding: 8px 16px; 
      font-size: 14px; 
      cursor: pointer;
      display: inline-flex; 
      align-items: center; 
      gap: 6px;
      transition: all 0.3s ease;
      z-index: 10;
    }
    .btn-back:hover{ 
      background: #4b5563;
      transform: translateY(-50%) translateY(-1px);
      box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
    }

    /* Page container aligned with dashboard layout */
    .page-container {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Section cards — same feel as dashboard cards */
    .card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 1.15rem;
      font-weight: 700;
      color: #1f2937;
    }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
    }

    .stat-item {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 14px;
      text-align: center;
    }
    .stat-number {
      font-size: 1.6rem;
      font-weight: 800;
      color: #1f2937;
      margin-bottom: 4px;
    }
    .stat-label {
      font-size: 0.85rem;
      color: #6b7280;
      font-weight: 600;
    }

    /* Filters row */
    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 14px;
      align-items: center;
    }
    .search-input, .filter-select {
      padding: 8px 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.85rem;
      background: #fff;
      min-width: 180px;
      max-width: 200px;
    }
    .btn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all .2s;
      white-space: nowrap;
    }
    
    .btn-small {
      padding: 5px 8px;
      font-size: 0.75rem;
      min-width: auto;
    }
    .btn-primary { background: #3b82f6; color: #fff; }
    .btn-primary:hover { background: #2563eb; }
    .btn-secondary { background: #f3f4f6; color: #374151; }
    .btn-secondary:hover { background: #e5e7eb; }
    .btn-danger { background: #ef4444; color: #fff; }
    .btn-danger:hover { background: #dc2626; }

    /* Table */
    .table-wrap {
      overflow-x: visible;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      background: #fff;
      table-layout: fixed;
    }
    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid #f3f4f6;
      text-align: right;
      vertical-align: middle;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    /* Column widths */
    th:nth-child(1), td:nth-child(1) { width: 25%; } /* معلومات الموظف */
    th:nth-child(2), td:nth-child(2) { width: 10%; } /* رقم الموظف */
    th:nth-child(3), td:nth-child(3) { width: 20%; } /* البريد الإلكتروني */
    th:nth-child(4), td:nth-child(4) { width: 12%; } /* الدور */
    th:nth-child(5), td:nth-child(5) { width: 18%; } /* تاريخ الانضمام */
    th:nth-child(6), td:nth-child(6) { width: 15%; } /* الإجراءات */
    th {
      background: #f9fafb;
      color: #374151;
      font-weight: 700;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    /* tbody tr:hover { background: #f9fafb; } */

    .employee-info .name {
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 2px;
    }
    .employee-info .sub {
      font-size: 0.85rem;
      color: #6b7280;
    }

    .role-badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 700;
      display: inline-block;
    }
    .role-employee { background: #d1fae5; color: #065f46; }
    .role-admin { background: #fee2e2; color: #991b1b; }
    .role-super { background: #dbeafe; color: #1e40af; }
    .role-system { background: #f3e8ff; color: #7c3aed; }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-start;
    }
    
    .actions .btn {
      padding: 4px 8px;
      font-size: 0.75rem;
      min-width: auto;
    }
    
    .actions .btn i {
      font-size: 0.7rem;
    }

    /* Inline alerts */
    .success-message,
    .error-message {
      display: none;
      padding: 12px 14px;
      border-radius: 10px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .success-message { background: #d1fae5; color: #065f46; }
    .error-message { background: #fee2e2; color: #991b1b; }


    /* Modals (match dashboard style) */
    .modal { display:none; position:fixed; inset:0; background: rgba(0,0,0,.4); z-index:1000; }
    .modal-content {
      background: #fff;
      width: min(520px, 92vw);
      max-height: 85vh;
      overflow: auto;
      border-radius: 12px;
      margin: 8vh auto 0;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }
    .modal-header {
      display:flex; align-items:center; justify-content:space-between;
      padding-bottom: 10px; border-bottom:1px solid #e5e7eb; margin-bottom:14px;
    }
    .modal-title { font-size:1.1rem; font-weight:800; color:#1f2937; }
    .close-btn { background:none; border:none; font-size:1.5rem; color:#6b7280; cursor:pointer; }
    .close-btn:hover { color:#111827; }
    .form-group { margin-bottom: 14px; }
    .form-label { display:block; font-weight:700; margin-bottom:6px; color:#374151; }
    .form-input {
      width:100%; padding:10px 12px; border:1px solid #d1d5db;
      border-radius:8px; font-size:.95rem; background:#fff;
    }
    .form-input:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.1); }
    .form-textarea { min-height:110px; resize:vertical; }
    .form-actions { display:flex; gap:8px; justify-content:flex-end; margin-top: 10px; }

    /* Impersonation banner (unchanged, but flatter to match style) */
    .impersonation-banner {
      position: fixed; top: 10px; left: 10px;
      background: #ef4444; color: #fff; padding: 8px 12px;
      border-radius: 8px; font-weight: 700; box-shadow: 0 2px 10px rgba(0,0,0,.12);
      display: none; z-index: 1100;
    }
    .impersonation-banner button {
      background: rgba(255,255,255,.2); border: none; color:#fff;
      padding: 6px 10px; border-radius:6px; cursor:pointer; margin-right:8px; font-weight:700;
    }
    .impersonation-banner button:hover { background: rgba(255,255,255,.3); }

    /* Responsive */
    @media (max-width: 768px) {
      .filters-row { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 6px;
      }
      .search-input, .filter-select { 
        min-width: 100%; 
        max-width: 100%;
        padding: 10px 12px;
        font-size: 0.9rem;
      }
      .btn {
        padding: 10px 14px;
        font-size: 0.9rem;
        justify-content: center;
      }
      
      /* Table responsive */
      table {
        font-size: 0.8rem;
      }
      th, td {
        padding: 8px 6px;
      }
      
      /* Adjust column widths for mobile */
      th:nth-child(1), td:nth-child(1) { width: 30%; } /* معلومات الموظف */
      th:nth-child(2), td:nth-child(2) { width: 8%; } /* رقم الموظف */
      th:nth-child(3), td:nth-child(3) { width: 22%; } /* البريد الإلكتروني */
      th:nth-child(4), td:nth-child(4) { width: 10%; } /* الدور */
      th:nth-child(5), td:nth-child(5) { width: 20%; } /* تاريخ الانضمام */
      th:nth-child(6), td:nth-child(6) { width: 10%; } /* الإجراءات */
      
      /* Smaller action buttons on mobile */
      .actions .btn {
        padding: 3px 6px;
        font-size: 0.7rem;
      }
      
      .actions .btn i {
        font-size: 0.65rem;
      }
    }
    
    @media (max-width: 480px) {
      table {
        font-size: 0.75rem;
      }
      th, td {
        padding: 6px 4px;
      }
      
      /* Even smaller action buttons on small screens */
      .actions .btn {
        padding: 2px 4px;
        font-size: 0.65rem;
      }
      
      .actions .btn i {
        font-size: 0.6rem;
      }
    }



.card:hover {
  background: #f7fafc !important;   
  color: inherit !important;    
  transform: none !important;       
}


.stat-item {
  transition: transform .15s ease, box-shadow .15s ease, background-color .15s ease;
}
.stat-item:hover {
  background: #f3f4f6;            /* very soft gray, consistent with dashboard */
  transform: translateY(-2px);     /* tiny lift */
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}



.actions .btn:hover {
  filter: brightness(0.96);
}


.card { cursor: default; }

  </style>

</head>
<body>
  <!-- Header (same component used in dashboard) -->
  <header class="header">
    <!-- زر العودة للخلف -->
    <button id="btnBack" class="btn-back" 
            data-ar="العودة" 
            data-en="Back">
      ← العودة
    </button>
    
    <div class="header-content">
      <div class="header-title" data-ar="بلاغات 937 — ادارة القسم" data-en="Department Management">
        إدارة القسم
      </div>
      <img src="../icon/hospital-logo.png" alt="شعار المستشفى" class="header-logo">
      <button id="langToggle" class="lang-toggle-btn">
        <img src="../icon/lang.png" alt="language" class="lang-icon" />
        <span id="langText">العربية | English</span>
      </button>
    </div>
  </header>

  

  <!-- Impersonation Banner -->
  <div id="impersonationBanner" class="impersonation-banner">
    <button onclick="endImpersonation()">🔙 العودة للسوبر أدمن</button>
    <span id="impersonationText">تم التبديل إلى حساب: </span>
  </div>

  <main class="page-container">
    <!-- Department Info -->
    <section class="card">
      <div class="section-header">
        <div class="section-title" id="departmentName">اسم القسم</div>
      </div>

      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number" id="totalEmployees">0</div>
          <div class="stat-label" data-ar="إجمالي الموظفين" data-en="Total Employees">إجمالي الموظفين</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="activeEmployees">0</div>
          <div class="stat-label" data-ar="الموظفون النشطون" data-en="Active Employees">الموظفون النشطون</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="pendingRequests">0</div>
          <div class="stat-label" data-ar="الطلبات المعلقة" data-en="Pending Requests">الطلبات المعلقة</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="newEmployees">0</div>
          <div class="stat-label" data-ar="موظفون جدد (هذا الشهر)" data-en="New Employees (This Month)">موظفون جدد (هذا الشهر)</div>
        </div>
      </div>
    </section>

    <!-- Employees -->
    <section class="card">
      <div class="section-header">
        <h2 class="section-title" data-ar="موظفو القسم" data-en="Department Employees">موظفو القسم</h2>
      </div>

      <!-- Filters -->
      <div class="filters-row">
        <input
          type="text"
          id="searchInput"
          class="search-input"
          placeholder="البحث..."
          data-ar-placeholder="البحث..."
          data-en-placeholder="Search..."
        />
        <select id="roleFilter" class="filter-select">
          <option value="" data-ar="جميع الأدوار" data-en="All Roles">جميع الأدوار</option>
          <option value="1" data-ar="سوبر أدمن" data-en="Super Admin">سوبر أدمن</option>
          <option value="2" data-ar="موظف" data-en="Employee">موظف</option>
          <option value="3" data-ar="مدير قسم" data-en="Department Admin">مدير قسم</option>
          <option value="4" data-ar="مدير النظام" data-en="System Manager">مدير النظام</option>
        </select>
        <div style="display: flex; gap: 4px; align-items: center;">
        <button class="btn btn-primary" onclick="applyFilters()">
          <i class="fas fa-search"></i>
          <span data-ar="بحث" data-en="Search">بحث</span>
        </button>
          <button class="btn btn-secondary btn-small" onclick="clearFilters()">
          <i class="fas fa-times"></i>
          <span data-ar="مسح" data-en="Clear">مسح</span>
        </button>
        </div>
      </div>

      <!-- Messages -->
      <div id="successMessage" class="success-message"></div>
      <div id="errorMessage" class="error-message"></div>

      <!-- Table -->
      <div class="table-wrap">
        <table class="employees-table">
          <thead>
            <tr>
              <th data-ar="معلومات الموظف" data-en="Employee Info">معلومات الموظف</th>
              <th data-ar="رقم الموظف" data-en="Employee ID">رقم الموظف</th>
              <th data-ar="البريد الإلكتروني" data-en="Email">البريد الإلكتروني</th>
              <th data-ar="الدور" data-en="Role">الدور</th>
              <th data-ar="تاريخ الانضمام" data-en="Join Date">تاريخ الانضمام</th>
              <th data-ar="الإجراءات" data-en="Actions">الإجراءات</th>
            </tr>
          </thead>
          <tbody id="employeesTableBody">
            <!-- Filled by department-management.js. تم تعديل النصوص بناءً على طلب المستخدم -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Delete Request Modal -->
  <div id="deleteModal" class="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="deleteModalTitle">
      <div class="modal-header">
  <h3 id="deleteModalTitle" class="modal-title" data-ar="إلغاء تنشيط الحساب" data-en="Deactivate Account">إلغاء تنشيط الحساب</h3>
        <button class="close-btn" onclick="closeModal('deleteModal')" aria-label="إغلاق">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label" data-ar="اسم الموظف" data-en="Employee Name">اسم الموظف</label>
          <input type="text" id="deleteEmployeeName" class="form-input" readonly />
        </div>
        <div class="form-group">
          <label class="form-label" data-ar="سبب إلغاء التنشيط" data-en="Deactivation Reason">سبب إلغاء التنشيط</label>
          <textarea id="deleteReason" class="form-input form-textarea" placeholder="اكتب سبب إلغاء تنشيط هذا الموظف"></textarea>
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" onclick="closeModal('deleteModal')">
            <span data-ar="إلغاء" data-en="Cancel">إلغاء</span>
          </button>
          <button class="btn btn-danger" onclick="submitDeleteRequest()">
            <i class="fas fa-trash"></i>
            <span data-ar="إرسال طلب إلغاء التنشيط" data-en="Submit Deactivation Request">إرسال طلب إلغاء التنشيط</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page behavior -->
  <script src="department-management.js"></script>
  <script>
    // Back button functionality
    document.getElementById('btnBack').addEventListener('click', function() {
      window.history.back();
    });

    // Mirror language toggle behavior used across the app
    (function initLang() {
      let currentLang = localStorage.getItem('lang') || 'ar';
      const langBtn = document.getElementById('langToggle');
      const langText = document.getElementById('langText');

      function applyLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('lang', lang);
        document.documentElement.lang = lang;
        document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.body.style.textAlign = lang === 'ar' ? 'right' : 'left';
        document.body.style.fontFamily = lang === 'ar' ? "'Tajawal', sans-serif" : "serif";

        document.querySelectorAll('[data-ar]').forEach(el => {
          el.textContent = el.getAttribute(`data-${lang}`);
        });
        document.querySelectorAll('[data-ar-placeholder]').forEach(el => {
          el.placeholder = el.getAttribute(`data-${lang}-placeholder`);
        });
        if (langText) {
          langText.textContent = lang === 'ar' ? 'العربية | English' : 'English | العربية';
        }

        // تعديل نصوص الإجراءات
        document.querySelectorAll('.actions').forEach(actions => {
          actions.querySelectorAll('button, a').forEach(btn => {
            // حذف كلمة النشاط
            if (btn.textContent.includes('النشاط')) {
              btn.textContent = btn.textContent.replace('النشاط', '').trim();
            }
            // حذف كلمة الصلاحيات
            if (btn.textContent.includes('الصلاحيات')) {
              btn.textContent = btn.textContent.replace('الصلاحيات', '').trim();
            }
            // استبدال كلمة حذف بـ إلغاء تنشيط الحساب
            if (btn.textContent.includes('حذف')) {
              btn.textContent = btn.textContent.replace('حذف', 'إلغاء تنشيط الحساب');
            }
          });
        });
      }
      applyLanguage(currentLang);

      if (langBtn) {
        langBtn.addEventListener('click', () => {
          applyLanguage(currentLang === 'ar' ? 'en' : 'ar');
        });
      }
    })();

    // Basic notif bubble click (same lightweight behavior as dashboard)
    (function initNotif() {
      const notifBtn = document.getElementById('notifBtn');
      const notifCount = document.getElementById('notifCount');
      if (notifBtn && notifCount) {
        notifBtn.addEventListener('click', () => {
          let n = parseInt(notifCount.textContent || '0', 10);
          if (n > 0) {
            notifCount.textContent = --n;
            if (n === 0) notifCount.style.display = 'none';
          }
        });
      }
    })();
  </script>
  
</body>

</html>

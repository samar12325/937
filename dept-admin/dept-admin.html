<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-ar="لوحة إدارة القسم" data-en="Department Admin Dashboard">Department Admin Dashboard</title>

  <!-- خطوط مطابقة للهوم -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <!-- نفس ملف التنسيق -->
  <link rel="stylesheet" href="dept-admin.css">
  
  <!-- Auth helpers -->
  <script src="../js/auth-helpers.js"></script>
  <!-- Impersonation banner -->
  <script src="../js/impersonation-banner.js"></script>
  
  <style>
    /* Header Layout Styles - Same as employee page */
    .header-content {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      width: 100% !important;
      max-width: none !important;
      margin: 0 !important;
    }
    
    .header-left {
      flex: 1 !important;
      display: flex !important;
      justify-content: flex-start !important;
    }
    
    .header-center {
      flex: 1 !important;
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
    }
    
    .header-right {
      flex: 1 !important;
      display: flex !important;
      justify-content: flex-end !important;
      align-items: center !important;
      gap: 15px !important;
      flex-wrap: nowrap !important;
    }
    
    .header-right > * {
      flex-shrink: 0 !important;
    }
    
    /* Ensure buttons and links stay in line */
    .profile-link,
    .notif-btn {
      white-space: nowrap !important;
      display: inline-flex !important;
      align-items: center !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    /* Keep language toggle button in original style */
    .lang-toggle-btn {
      white-space: nowrap !important;
      display: inline-flex !important;
      align-items: center !important;
      margin: 0 !important;
      padding: 0 !important;
      /* Restore original button styling */
      background: #3b82f6 !important;
      color: white !important;
      border: none !important;
      border-radius: 8px !important;
      padding: 8px 12px !important;
      cursor: pointer !important;
      transition: background 0.2s ease !important;
    }
    
    .lang-toggle-btn:hover {
      background: #2563eb !important;
    }
    
    /* Icon formatting - تكبير محتوى الصور */
    .card img {
      width: 24px;
      height: 24px;
      margin: 0 auto 0px;
      object-fit: contain;
      transform: scale(2);
    }
    
    .card-icon-small {
      width: 22px;
      height: 22px;
      margin-bottom: 0px;
      transition: all 0.3s ease;
      transform: scale(2);
    }
    
    /* Card hover effects exactly like employee page */
    .card {
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
    }
    
    .card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      border-color: #3b82f6;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .card:hover::before {
      transform: scaleX(1);
    }
    
    .card img {
      transition: all 0.3s ease;
      filter: grayscale(0.2);
    }
    
    .card:hover img {
      transform: scale(1.1) rotate(5deg);
      filter: grayscale(0) brightness(1.1);
    }
    
    .card h3 {
      transition: color 0.3s ease;
    }
    
    .card:hover h3 {
      color: #3b82f6;
    }
    
    .card .btn {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .card .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .card:hover .btn::before {
      left: 100%;
    }
    
    .card .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }
    
    /* Card Content Layout - Same Height */
    .card {
      justify-content: space-between;
      align-items: center;
      text-align: center;
    }
    
    .card .btn {
      margin: 20px auto 0;
      align-self: center;
      width: 80%;
      padding: 8px 16px;
      font-size: 14px;
    }
    
    /* Ensure proper spacing between elements */
    .card img {
      margin: 10px auto;
    }
    
    .card h3 {
      margin: 10px auto;
      min-height: 72px;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.4;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    
    .card p {
      flex-grow: 1;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 15px 0;
      padding: 0 15px;
      text-align: center;
      min-height: 108px;
      line-height: 1.6;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    /* Cards Grid Layout - Same Height */
    .dashboard {
      padding: 20px;
      gap: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      align-items: stretch;
      justify-items: center;
    }
    
    .card {
      margin: 0;
      padding: 20px;
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    /* Force separate positioning */
    .header-right .profile-link {
      order: 1 !important;
    }
    
    .header-right .notif-btn {
      order: 2 !important;
    }
    
    .header-right .lang-toggle-btn {
      order: 3 !important;
    }
    
    /* Prevent header from breaking on small screens */
    @media (max-width: 768px) {
      .header-content {
        flex-wrap: nowrap;
        overflow: hidden;
      }
      
      .header-left,
      .header-center,
      .header-right {
        min-width: 0;
      }
      
      .header-title {
        font-size: 14px;
      }
    }
    
    /* لمسة بسيطة لتوسيط البطاقة الكبيرة */
    .dashboard { flex-wrap: wrap; }
    .card.full { flex-basis: 100%; }
    .kpi-wrap { margin: 12px 40px; display: grid; grid-template-columns: repeat(4,minmax(160px,1fr)); gap: 14px; }
    .kpi { background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:14px; box-shadow:0 4px 10px rgba(0,0,0,.04); }
    .kpi .t{font-size:.92rem;color:#374151}
    .kpi .v{font-weight:800;font-size:1.35rem;color:#0f172a}
    .list-card{ background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px; box-shadow:0 4px 10px rgba(0,0,0,.04); margin:16px 40px 24px;}
    .comp-table{width:100%;border-collapse:collapse;font-size:.95rem}
    .comp-table th,.comp-table td{padding:10px 12px;border-bottom:1px solid #eee;text-align:center;white-space:nowrap}
    .comp-table thead th{background:#f8fafc;font-weight:600;position:sticky;top:0;z-index:1}
    .kpi-refresh{display:flex;align-items:center;justify-content:center;margin-top:10px}
    .refresh-btn{background:#3b82f6;color:white;border:none;border-radius:8px;padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:6px;font-size:.9rem;transition:all .2s ease}
    .refresh-btn:hover{background:#2563eb;transform:scale(1.05)}
    .refresh-btn:disabled{opacity:0.7;cursor:not-allowed}
    .refresh-btn svg{width:14px;height:14px}
    .animate-spin{animation:spin 1s linear infinite}
    @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    
    /* Report Distribution Styles */
    .complaints-filters {
      display: flex;
      gap: 15px;
      align-items: end;
      flex-wrap: wrap;
    }

    .complaints-filters .filter-group {
      margin-bottom: 0;
    }

    .filter-select, .search-btn {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }

    .search-btn {
      background: #3b82f6;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .search-btn:hover {
      background: #2563eb;
    }

    .worklist-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .worklist-table th,
    .worklist-table td {
      padding: 12px;
      text-align: right;
      border-bottom: 1px solid #e5e7eb;
    }

    .worklist-table th {
      background: #f9fafb;
      font-weight: 600;
      color: #374151;
    }

    .btn-small {
      padding: 6px 12px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.2s ease;
    }

    .btn-assign {
      background: #10b981;
      color: white;
    }

    .btn-assign:hover {
      background: #059669;
    }

    .btn-view {
      background: #3b82f6;
      color: white;
    }

    .btn-view:hover {
      background: #2563eb;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-new { background: #dbeafe; color: #1e40af; }
    .status-progress { background: #fef3c7; color: #92400e; }
    .status-resolved { background: #d1fae5; color: #065f46; }
    .status-closed { background: #f3f4f6; color: #374151; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-title" data-ar="بلاغات 937 — مدير القسم" data-en="Reports 937 — Department Admin">بلاغات 937 — مدير القسم</div>
      </div>
      
      <div class="header-center">
        <img src="/icon/hospital-logo.png" alt="شعار" class="header-logo"/>
      </div>
      
      <div class="header-right">
        <a href="/login/profile.html" class="profile-link">
          <img src="/icon/patient1.png" class="profile-icon-small" alt="الملف الشخصي">
          <span data-ar="الملف الشخصي" data-en="Profile">الملف الشخصي</span>
        </a>

        <button id="notifBtn" class="notif-btn" title="الإشعارات">
          <svg class="notif-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 2c.7 0 1.25.56 1.25 1.25v.51A6.75 6.75 0 0 1 19 10.5v4.06l1.49 2.49c.3.5-.06 1.12-.64 1.12H4.15c-.58 0-.94-.62-.64-1.12L5 14.56V10.5A6.75 6.75 0 0 1 10.75 3.76v-.51C10.75 2.56 11.3 2 12 2zm0 20a2.75 2.75 0 0 1-2.62-2h5.24A2.75 2.75 0 0 1 12 22z"/>
          </svg>
          <span id="notifCount" class="notif-count" style="display:none;">0</span>
        </button>

        <button id="langToggle" class="lang-toggle-btn">
          <img src="/icon/lang.png" class="lang-icon" alt="اللغة"/>
          <span id="langText">العربية | English</span>
        </button>
      </div>
    </div>
  </header>

<!-- Banner hidden by default -->
<div id="impersonation-banner" style="display:none; position:fixed; top:10px; left:10px; z-index:9999;">
  <button id="end-impersonation-btn"
          style="padding:8px 12px; border:none; border-radius:6px; background:#dc2626; color:#fff; cursor:pointer;">
    🔙 الرجوع لحساب السوبر
  </button>
</div>

  <main>
    <!-- كروت مدير القسم فقط -->
    <section class="dashboard">


      <!-- لوحة القسم الجديدة -->
      <div class="card permission-gated" data-permission="department_panel" style="display: none;">
        <img src="../icon/chart.png" alt="لوحة القسم" class="card-icon">
        <h3 data-ar="لوحة القسم" data-en="Department Panel">لوحة القسم</h3>
        <p data-ar="نظرة شاملة على بلاغات وطلبات القسم" data-en="Comprehensive management of your department">نظرة شاملة على بلاغات وطلبات القسم</p>
        <a href="dept-dashboard.html" class="btn" data-ar="فتح اللوحة" data-en="Open Panel">فتح اللوحة</a>
      </div>

      <!-- تقديم بلاغ جديد -->
      <div class="card permission-gated" data-permission="submit_complaint" style="display: none;">
        <img src="../icon/plus.png" alt="تقديم بلاغ" class="card-icon">
        <h3 data-ar="تقديم بلاغ جديد" data-en="Submit New Report">تقديم بلاغ جديد</h3>
        <p data-ar="قم بتسجيل بلاغ طبي جديد" data-en="Register a new medical report">قم بتسجيل بلاغ طبي جديد</p>
        <a href="../New complaint/Newcomplaint.html" class="btn" data-ar="تقديم بلاغ" data-en="Submit Report">تقديم بلاغ</a>
      </div>


      <!-- متابعة البلاغات -->
      <div class="card permission-gated" data-permission="follow_own_complaint" style="display: none;">
        <img src="../icon/list.png" alt="متابعة البلاغات" class="card-icon">
        <h3 data-ar="متابعة البلاغات" data-en="Follow Reports">متابعة البلاغات</h3>
        <p data-ar="تتبع حالة بلاغاتك المقدمة" data-en="Track the status of your submitted reports">تتبع حالة بلاغاتك المقدمة</p>
        <a href="../Complaints-followup/followup.html" class="btn" data-ar="متابعة البلاغات" data-en="Follow Reports">متابعة البلاغات</a>
      </div>

      <!-- موظفي القسم -->
      <div class="card permission-gated" data-permission="department_employees" style="display: none;">
        <img src="../icon/group.png" alt="موظفي القسم" class="card-icon">
        <h3 data-ar="موظفي القسم" data-en="Department Employees">موظفي القسم</h3>
        <p data-ar="إدارة موظفي القسم وصلاحياتهم" data-en="Manage department employees and permissions">إدارة موظفي القسم وصلاحياتهم</p>
        <a href="department-management.html" class="btn" data-ar="إدارة الموظفين" data-en="Manage Employees">إدارة الموظفين</a>
      </div>

      <!-- بلاغات القسم -->
      <div class="card permission-gated" data-permission="department_complaints" style="display: none;">
        <img src="../icon/list.png" alt="بلاغات القسم" class="card-icon">
        <h3 data-ar="بلاغات القسم" data-en="Department Reports">بلاغات القسم</h3>
        <p data-ar="عرض وإدارة بلاغات القسم" data-en="View and manage department complaints">عرض وإدارة بلاغات القسم</p>
        <a href="department-complaints.html" class="btn" data-ar="عرض البلاغات" data-en="View Reports">عرض البلاغات</a>
      </div>
      


      <!-- توزيع البلاغات -->
      <div class="card permission-gated" data-permission="complaint_distribution" style="display: none;">
        <img src="../icon/fromto.png" alt="توزيع البلاغات" class="card-icon">
        <h3 data-ar="توزيع البلاغات" data-en="Report Distribution">توزيع البلاغات</h3>
        <p data-ar="توزيع البلاغات على الأقسام" data-en="Distribute complaints to departments">توزيع البلاغات على الأقسام</p>
        <a href="../director/complaint-distribution.html" class="btn" data-ar="توزيع البلاغات" data-en="Distribute Reports">توزيع البلاغات</a>
      </div>

      <!-- توزيع البلاغات للموظفين -->
      <div class="card permission-gated" data-permission="employee_distribution" style="display: none;">
        <img src="../icon/SeeAllPublicComp.png" alt="توزيع البلاغات للموظفين" class="card-icon">
        <h3 data-ar="توزيع البلاغات للموظفين" data-en="Distribute Reports to Employees">توزيع البلاغات للموظفين</h3>
        <p data-ar="توزيع البلاغات على موظفين محددين في القسم" data-en="Distribute complaints to specific employees in the department">توزيع البلاغات على موظفين محددين في القسم</p>
        <button onclick="openEmployeeDistribution()" class="btn" data-ar="توزيع للموظفين" data-en="Distribute to Employees">توزيع للموظفين</button>
      </div>


      <!-- توزيع بلاغات الزائر السري -->
      <div class="card permission-gated" data-permission="secret_visitor_distribution" style="display: none;">
        <img src="../icon/Staaff.png" alt="توزيع بلاغات الزائر السري" class="card-icon">
        <h3 data-ar="توزيع بلاغات الزائر السري" data-en="Secret Visitor Distribution">توزيع بلاغات الزائر السري</h3>
        <p data-ar="توزيع ملاحظات الزائر السري على الأقسام المختلفة" data-en="Distribute secret visitor notes to different departments">توزيع ملاحظات الزائر السري على الأقسام المختلفة</p>
        <a href="../DashBoard/secret-visitor-distribution.html" class="btn" data-ar="توزيع البلاغات" data-en="Distribute Reports">توزيع البلاغات</a>
      </div>

      <!-- توزيع بلاغات الزائر السري الخاصة بالقسم -->

      <!-- توزيع بلاغات الزائر السري على الموظفين داخل القسم -->
      <div class="card permission-gated" data-permission="secret_visitor_employee_distribution" style="display: none;">
        <img src="../icon/SeeAllPublicComp.png" alt="توزيع بلاغات الزائر السري على الموظفين" class="card-icon">
        <h3 data-ar="توزيع بلاغات الزائر السري على الموظفين داخل القسم" data-en="Distribute Secret Visitor Reports to Department Employees">توزيع بلاغات الزائر السري على الموظفين داخل القسم</h3>
        <p data-ar="توزيع بلاغات الزائر السري على موظفين محددين داخل القسم" data-en="Distribute secret visitor reports to specific employees within the department">توزيع بلاغات الزائر السري على موظفين محددين داخل القسم</p>
        <a href="dept-secret-visitor-employee-distribution.html" class="btn" data-ar="توزيع على الموظفين" data-en="Distribute to Employees">توزيع على الموظفين</a>
      </div>

      <!-- بلاغات الزائر السري المسندة لي -->
      <div class="card permission-gated" data-permission="secret_visitor_assigned_reports" style="display: none;">
        <img src="../icon/FollowUpPrivateComp.png" alt="بلاغات الزائر السري المسندة لي" class="card-icon">
        <h3 data-ar="بلاغات الزائر السري المسندة لي" data-en="My Assigned Secret Visitor Reports">بلاغات الزائر السري المسندة لي</h3>
        <p data-ar="عرض والرد على بلاغات الزائر السري المسندة إليك" data-en="View and respond to secret visitor reports assigned to you">عرض والرد على بلاغات الزائر السري المسندة إليك</p>
        <a href="dept-assigned-secret-visitor-reports.html" class="btn" data-ar="عرض البلاغات" data-en="View Reports">عرض البلاغات</a>
      </div>

      <!-- لوحة المعلومات -->
      <div class="card permission-gated" data-permission="dashboard" style="display: none;">
        <img src="../icon/chart.png" alt="لوحة المعلومات" class="card-icon">
        <h3 data-ar="لوحة المعلومات" data-en="Dashboard">لوحة المعلومات</h3>
        <p data-ar="إحصائيات وتحليلات الشكاوى" data-en="Complaint statistics and analytics">إحصائيات وتحليلات الشكاوى</p>
        <a href="../DashBoard/overview.html" class="btn" data-ar="عرض التفاصيل" data-en="View Details">عرض التفاصيل</a>
      </div>

      <!-- البلاغات العامة -->
      <div class="card permission-gated" data-permission="view_public_complaints" style="display: none;">
        <img src="../icon/group.png" alt="البلاغات العامة" class="card-icon">
        <h3 data-ar="البلاغات العامة" data-en="General Reports">البلاغات العامة</h3>
        <p data-ar="عرض وإدارة البلاغات العامة" data-en="View and manage general complaints">عرض وإدارة البلاغات العامة</p>
        <a href="../general complaints/general-complaints.html" class="btn" data-ar="عرض البلاغات" data-en="View Reports">عرض البلاغات</a>
      </div>

      <!-- إدارة الصلاحيات -->
      <div class="card permission-gated" data-permission="manage_permissions" style="display: none;">
        <img src="../icon/setting.png" alt="إدارة الصلاحيات" class="card-icon">
        <h3 data-ar="إدارة الصلاحيات" data-en="Permissions Management">إدارة الصلاحيات</h3>
        <p data-ar="إدارة صلاحيات الموظفين والأدوار" data-en="Manage employee permissions and roles">إدارة صلاحيات الموظفين والأدوار</p>
        <a href="../superadmin/permissions.html" class="btn" data-ar="إدارة الصلاحيات" data-en="Manage Permissions">إدارة الصلاحيات</a>
      </div>


      <!-- Permission Management -->
      <div class="card permission-gated" data-permission="rbac.manage" style="display: none;">
        <img src="../icon/UserManagement.png" alt="إدارة الصلاحيات" class="card-icon">
        <h3 data-ar="إدارة الصلاحيات" data-en="Permission Management">إدارة الصلاحيات</h3>
        <p data-ar="إدارة الأدوار وتعيين الصلاحيات لمستخدمي القسم" data-en="Manage roles and assign permissions to department users">إدارة الأدوار وتعيين الصلاحيات لمستخدمي القسم</p>
        <a href="#" onclick="openPermissionManagement()" class="btn" data-ar="إدارة الصلاحيات" data-en="Manage Permissions">إدارة الصلاحيات</a>
      </div>

      <!-- البلاغات المحذوفة -->
      <div class="card permission-gated" data-permission="deleted_complaints" style="display: none;">
        <img src="../icon/alert.png" alt="البلاغات المحذوفة" class="card-icon">
        <h3 data-ar="البلاغات المحذوفة" data-en="Deleted Reports">البلاغات المحذوفة</h3>
        <p data-ar="إدارة واسترجاع البلاغات المحذوفة من النظام" data-en="Manage and restore deleted complaints from the system">
          إدارة واسترجاع البلاغات المحذوفة من النظام
        </p>
        <a href="../superadmin/deleted-complaints.html" class="btn" data-ar="إدارة المحذوفة" data-en="Manage Deleted">
          إدارة المحذوفة
        </a>
      </div>

      <!-- السجلات -->
      <div class="card permission-gated" data-permission="records" style="display: none;">
        <img src="../icon/document.png" alt="السجلات" class="card-icon">
        <h3 data-ar="السجلات" data-en="Records">السجلات</h3>
        <p data-ar="الاطلاع على سجلات العمليات والشكاوى" data-en="View operation and complaint records">
          الاطلاع على سجلات العمليات والشكاوى
        </p>
        <a href="../superadmin/logs.html" class="btn" data-ar="عرض السجلات" data-en="View Records">
          عرض السجلات
        </a>
      </div>

      <div class="card permission-gated" data-permission="user_management" style="display: none;">
        <img src="../icon/setting.png" alt="إدارة المستخدمين" class="card-icon">
        <h3 data-ar="إدارة المستخدمين" data-en="User Management">إدارة المستخدمين</h3>
        <p data-ar="إدارة الحسابات والأدوار والصلاحيات" data-en="Manage accounts, roles, and permissions">
          إدارة الحسابات والأدوار والصلاحيات
        </p>
        <a href="../superadmin/manage-users.html" class="btn" data-ar="إدارة المستخدمين" data-en="User Management">
          إدارة المستخدمين
        </a>
      </div>

    </section>

    <!-- KPIs الخاصة بالقسم -->
    <section class="kpi-wrap" id="kpiWrap">
      <div class="kpi"><div class="t" data-ar="إجمالي بلاغات القسم" data-en="Total Department Reports">إجمالي بلاغات القسم</div><div class="v" id="kpiTotal">—</div></div>
      <div class="kpi"><div class="t" data-ar="المفتوحة" data-en="Open">المفتوحة</div><div class="v" id="kpiOpen">—</div></div>
      <div class="kpi"><div class="t" data-ar="قيد المعالجة" data-en="In Progress">قيد المعالجة</div><div class="v" id="kpiWip">—</div></div>
      <div class="kpi"><div class="t" data-ar="المغلقة" data-en="Closed">المغلقة</div><div class="v" id="kpiClosed">—</div></div>
      <div class="kpi-refresh">
        <button onclick="refreshDashboardData()" class="refresh-btn" title="Refresh Dashboard Data" data-ar="تحديث البيانات" data-en="Refresh Data">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- آخر بلاغات القسم -->
    <section class="list-card">
      <div class="table-title" data-ar="آخر 10 بلاغات القسم" data-en="Latest 10 Department Reports">آخر 10 بلاغات القسم</div>
      <table class="comp-table" id="complaintsTable">
        <thead>
          <tr>
            <th data-ar="رقم البلاغ" data-en="Report ID">رقم البلاغ</th>
            <th data-ar="الموظف المسؤول" data-en="Assigned Employee">الموظف المسؤول</th>
            <th data-ar="الحالة" data-en="Status">الحالة</th>
            <th data-ar="تاريخ التقديم" data-en="Submission Date">تاريخ التقديم</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

  </main>

  <!-- Department Employees Modal -->
  <div id="employeesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ar="موظفي القسم" data-en="Department Employees">Department Employees</h2>
        <span class="close" onclick="closeModal('employeesModal')">&times;</span>
      </div>
      <div class="modal-body">
        <!-- Search and Filters Section -->
        <div class="search-filters-section">
          <div class="search-bar">
            <input type="text" id="employeeSearch" placeholder="Search by Full Name or Employee ID..." data-ar-placeholder="البحث بالاسم الكامل أو رقم الموظف..." data-en-placeholder="Search by Full Name or Employee ID...">
            <button onclick="searchEmployees()" data-ar="بحث" data-en="Search">Search</button>
            <button onclick="clearEmployeeFilters()" data-ar="مسح الفلاتر" data-en="Clear Filters">Clear Filters</button>
          </div>
          <div class="quick-filters">
            <select id="roleFilter" onchange="filterEmployees()">
              <option value="" data-ar="جميع الأدوار" data-en="All Roles">All Roles</option>
              <option value="EMPLOYEE" data-ar="موظف" data-en="Employee">Employee</option>
              <option value="ADMIN" data-ar="مدير قسم" data-en="Department Admin">Department Admin</option>
            </select>
            <select id="statusFilter" onchange="filterEmployees()">
              <option value="" data-ar="جميع الحالات" data-en="All Status">All Status</option>
              <option value="active" data-ar="نشط" data-en="Active">Active</option>
              <option value="inactive" data-ar="غير نشط" data-en="Inactive">Inactive</option>
            </select>
          </div>
        </div>

        <!-- Loading State -->
        <div id="employeesLoading" class="loading-overlay" style="display: none;">
          <div class="loading-spinner"></div>
        </div>

        <!-- Empty State -->
        <div id="employeesEmptyState" class="empty-state" style="display: none;">
          <p data-ar="لا يوجد موظفين في قسمك" data-en="No employees found in your department">No employees found in your department</p>
          <button onclick="clearEmployeeFilters()" data-ar="مسح الفلاتر" data-en="Clear Filters">Clear Filters</button>
        </div>

        <!-- Error State -->
        <div id="employeesErrorState" class="error-state" style="display: none;">
          <p data-ar="حدث خطأ في تحميل البيانات" data-en="Error loading data">Error loading data</p>
          <button onclick="loadDepartmentEmployees()" data-ar="إعادة المحاولة" data-en="Retry">Retry</button>
        </div>

        <!-- Employees Table -->
        <div class="employees-table-container">
          <table id="employeesTable" class="data-table">
            <thead>
              <tr>
                <th onclick="sortEmployees('EmployeeID')" class="sortable" data-ar="رقم الموظف" data-en="Employee ID">Employee ID <span class="sort-icon">↕</span></th>
                <th onclick="sortEmployees('FullName')" class="sortable" data-ar="الاسم الكامل" data-en="Full Name">Full Name <span class="sort-icon">↕</span></th>
                <th data-ar="البريد الإلكتروني" data-en="Email">Email</th>
                <th data-ar="القسم" data-en="Department">Department</th>
                <th data-ar="الدور" data-en="Role">Role</th>
                <th data-ar="الحالة" data-en="Status">Status</th>
                <th data-ar="الهاتف" data-en="Phone">Phone</th>
                <th data-ar="اسم المستخدم" data-en="Username">Username</th>
                <th data-ar="الإجراءات" data-en="Actions">Actions</th>
              </tr>
            </thead>
            <tbody id="employeesTableBody">
              <!-- Employees will be loaded here -->
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="employeesPagination" style="display: none;">
          <button onclick="previousPage()" data-ar="السابق" data-en="Previous">Previous</button>
          <span id="pageInfo" data-ar="الصفحة" data-en="Page">Page</span>
          <button onclick="nextPage()" data-ar="التالي" data-en="Next">Next</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Department Reports Modal -->
  <div id="complaintsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ar="بلاغات القسم" data-en="Department Reports">Department Reports</h2>
        <span class="close" onclick="closeModal('complaintsModal')">&times;</span>
      </div>
      <div class="modal-body">
        <div class="search-bar">
          <input type="text" id="complaintSearch" placeholder="Search complaints..." data-ar-placeholder="البحث في الشكاوى..." data-en-placeholder="Search complaints...">
          <button onclick="searchComplaints()" data-ar="بحث" data-en="Search">Search</button>
        </div>
        <div class="complaints-table-container">
          <table id="departmentComplaintsTable" class="data-table">
            <thead>
              <tr>
                <th data-ar="رقم البلاغ" data-en="Report ID">Report ID</th>
                <th data-ar="الموظف المسؤول" data-en="Assigned Employee">Assigned Employee</th>
                <th data-ar="الحالة" data-en="Status">Status</th>
                <th data-ar="تاريخ التقديم" data-en="Submission Date">Submission Date</th>
                <th data-ar="الإجراءات" data-en="Actions">Actions</th>
              </tr>
            </thead>
            <tbody id="departmentComplaintsTableBody">
              <!-- Complaints will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Complaint Assignment Modal -->
  <div id="assignmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ar="توزيع البلاغات" data-en="Complaint Assignment">Complaint Assignment</h2>
        <span class="close" onclick="closeModal('assignmentModal')">&times;</span>
      </div>
      <div class="modal-body">
        <div class="assignment-filters">
          <select id="complaintFilter" onchange="filterComplaintsForAssignment()">
            <option value="unassigned" data-ar="غير مخصصة" data-en="Unassigned">Unassigned</option>
            <option value="all" data-ar="جميع الشكاوى" data-en="All Complaints">All Complaints</option>
          </select>
        </div>
                 <div class="assignment-table-container">
           <table id="assignmentTable" class="data-table">
             <thead>
               <tr>
                 <th data-ar="رقم البلاغ" data-en="Report ID">Report ID</th>
                 <th data-ar="الموظف المسؤول" data-en="Assigned Employee">Assigned Employee</th>
                 <th data-ar="الحالة" data-en="Status">Status</th>
                 <th data-ar="تاريخ التقديم" data-en="Submission Date">Submission Date</th>
                 <th data-ar="الإجراءات" data-en="Actions">Actions</th>
               </tr>
             </thead>
             <tbody id="assignmentTableBody">
               <!-- Assignment data will be loaded here -->
             </tbody>
           </table>
         </div>
      </div>
    </div>
  </div>

  <!-- Department Logs Modal -->
  <div id="logsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ar="سجلات القسم" data-en="Department Logs">Department Logs</h2>
        <span class="close" onclick="closeModal('logsModal')">&times;</span>
      </div>
      <div class="modal-body">
        <div class="logs-filters">
          <select id="logType" onchange="filterDepartmentLogs()">
            <option value="all" data-ar="جميع السجلات" data-en="All Logs">All Logs</option>
            <option value="login" data-ar="تسجيل دخول" data-en="Login">Login</option>
            <option value="complaint" data-ar="شكاوى" data-en="Complaints">Complaints</option>
            <option value="assignment" data-ar="توزيع" data-en="Assignment">Assignment</option>
          </select>
        </div>
        <div class="logs-table-container">
          <table id="departmentLogsTable" class="data-table">
            <thead>
              <tr>
                <th data-ar="الوقت" data-en="Time">Time</th>
                <th data-ar="الموظف" data-en="Employee">Employee</th>
                <th data-ar="النوع" data-en="Type">Type</th>
                <th data-ar="الوصف" data-en="Description">Description</th>
              </tr>
            </thead>
            <tbody id="departmentLogsTableBody">
              <!-- Logs will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Department Permissions Modal -->
  <div id="permissionsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ar="إدارة صلاحيات القسم" data-en="Department Permission Management">Department Permission Management</h2>
        <span class="close" onclick="closeModal('permissionsModal')">&times;</span>
      </div>
      <div class="modal-body">
        <div class="search-bar">
          <input type="text" id="permissionSearch" placeholder="Search by name or employee number..." data-ar-placeholder="البحث بالاسم أو رقم الموظف..." data-en-placeholder="Search by name or employee number...">
          <button onclick="searchEmployeesForPermissions()" data-ar="بحث" data-en="Search">Search</button>
        </div>
        <div class="permissions-table-container">
          <table id="permissionsTable" class="data-table">
            <thead>
              <tr>
                <th data-ar="الاسم" data-en="Name">Name</th>
                <th data-ar="رقم الموظف" data-en="Employee Number">Employee Number</th>
                <th data-ar="الدور الحالي" data-en="Current Role">Current Role</th>
                <th data-ar="الصلاحيات" data-en="Permissions">Permissions</th>
                <th data-ar="الإجراءات" data-en="Actions">Actions</th>
              </tr>
            </thead>
            <tbody id="permissionsTableBody">
              <!-- Permissions data will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
     </div>

   <!-- Individual Assignment Modal -->
   <div id="individualAssignmentModal" class="modal">
     <div class="modal-content">
       <div class="modal-header">
         <h2 data-ar="توزيع البلاغ" data-en="Assign Report">Assign Report</h2>
         <span class="close" onclick="closeIndividualAssignmentModal()">&times;</span>
       </div>
       <div class="modal-body">
         <!-- Loading State -->
         <div id="assignmentLoading" class="loading-overlay" style="display: none;">
           <div class="loading-spinner"></div>
           <p data-ar="جاري تحميل الموظفين..." data-en="Loading employees...">Loading employees...</p>
         </div>
         
         <div class="form-group">
           <label for="employeeSelect" data-ar="اختر موظف:" data-en="Select Employee:">Select Employee:</label>
           <select id="employeeSelect" class="form-control">
             <option value="">اختر موظف...</option>
           </select>
         </div>
         <div class="modal-actions">
           <button onclick="closeIndividualAssignmentModal()" class="btn-cancel" data-ar="إلغاء" data-en="Cancel">Cancel</button>
           <button onclick="confirmAssignment()" class="btn-confirm" data-ar="تأكيد التوزيع" data-en="Confirm Assignment">Confirm Assignment</button>
         </div>
       </div>
     </div>
   </div>

   <!-- Edit Permissions Modal -->
   <div id="editPermissionsModal" class="modal">
     <div class="modal-content">
       <div class="modal-header">
         <h2 data-ar="تعديل صلاحيات الموظف" data-en="Edit Employee Permissions">Edit Employee Permissions</h2>
         <span class="close" onclick="closeEditPermissionsModal()">&times;</span>
       </div>
       <div class="modal-body">
         <!-- Loading State -->
         <div id="permissionsLoading" class="loading-overlay" style="display: none;">
           <div class="loading-spinner"></div>
           <p data-ar="جاري تحميل الصلاحيات..." data-en="Loading permissions...">Loading permissions...</p>
         </div>
         
         <!-- Employee Info -->
         <div class="employee-info-section">
           <h3 id="employeeName" data-ar="اسم الموظف" data-en="Employee Name">Employee Name</h3>
           <p id="employeeDetails" data-ar="تفاصيل الموظف" data-en="Employee Details">Employee Details</p>
         </div>
         
         <!-- Permissions Section -->
         <div class="permissions-section">
           <h4 data-ar="الصلاحيات المتاحة" data-en="Available Permissions">Available Permissions</h4>
           <div class="permissions-grid" id="permissionsGrid">
             <!-- Permissions checkboxes will be loaded here -->
           </div>
         </div>
         
         <div class="modal-actions">
           <button onclick="closeEditPermissionsModal()" class="btn-cancel" data-ar="إلغاء" data-en="Cancel">Cancel</button>
           <button onclick="saveEmployeePermissions()" class="btn-confirm" data-ar="حفظ الصلاحيات" data-en="Save Permissions">Save Permissions</button>
         </div>
       </div>
     </div>
   </div>

   <!-- Report Distribution Modal -->
   <div id="complaintDistributionModal" class="modal">
     <div class="modal-content" style="max-width: 90%; width: 1200px;">
       <div class="modal-header">
         <h2 data-ar="توزيع البلاغات" data-en="Report Distribution">توزيع البلاغات</h2>
         <span class="close" onclick="closeModal('complaintDistributionModal')">&times;</span>
       </div>
       <div class="modal-body">
         <div class="complaints-filters" style="margin-bottom: 20px;">
           <div class="filter-group">
             <label data-ar="الحالة:" data-en="Status:">الحالة:</label>
             <select id="distributionStatusFilter" class="filter-select">
               <option value="" data-ar="جميع الحالات" data-en="All Statuses">جميع الحالات</option>
               <option value="جديدة" data-ar="جديدة" data-en="New">جديدة</option>
               <option value="قيد المعالجة" data-ar="قيد المعالجة" data-en="In Progress">قيد المعالجة</option>
               <option value="تم الحل" data-ar="تم الحل" data-en="Resolved">تم الحل</option>
               <option value="مغلقة" data-ar="مغلقة" data-en="Closed">مغلقة</option>
             </select>
           </div>
           <div class="filter-group">
             <label data-ar="التوزيع:" data-en="Assignment:">التوزيع:</label>
             <select id="distributionAssignmentFilter" class="filter-select">
               <option value="" data-ar="جميع الشكاوى" data-en="All Complaints">جميع الشكاوى</option>
               <option value="assigned" data-ar="مخصصة" data-en="Assigned">مخصصة</option>
               <option value="unassigned" data-ar="غير مخصصة" data-en="Unassigned">غير مخصصة</option>
             </select>
           </div>
           <button onclick="loadDistributionComplaints()" class="search-btn" data-ar="تحديث" data-en="Refresh">تحديث</button>
         </div>
         <table class="worklist-table">
           <thead>
             <tr>
               <th data-ar="رقم البلاغ" data-en="Report ID">رقم البلاغ</th>
               <th data-ar="اسم المريض" data-en="Patient Name">اسم المريض</th>
               <th data-ar="نوع البلاغ" data-en="Report Type">نوع البلاغ</th>
               <th data-ar="تاريخ الإنشاء" data-en="Created Date">تاريخ الإنشاء</th>
               <th data-ar="الحالة" data-en="Status">الحالة</th>
               <th data-ar="المسند إلى" data-en="Assigned To">المسند إلى</th>
               <th data-ar="الإجراءات" data-en="Actions">الإجراءات</th>
             </tr>
           </thead>
           <tbody id="distributionComplaintsTableBody">
             <!-- Distribution complaints data will be loaded here -->
           </tbody>
         </table>
       </div>
     </div>
   </div>

  <!-- Employee Distribution Modal -->
  <div id="employeeDistributionModal" class="modal" style="z-index: 9999;">
    <div class="modal-content" style="max-width: 90%; width: 1200px;">
      <div class="modal-header">
        <h2 data-ar="توزيع البلاغات للموظفين" data-en="Distribute Reports to Employees">توزيع البلاغات للموظفين</h2>
        <span class="close" onclick="closeModal('employeeDistributionModal')">&times;</span>
      </div>
      <div class="modal-body">
        <div class="complaints-filters" style="margin-bottom: 20px;">
          <div class="filter-group">
            <label data-ar="الحالة:" data-en="Status:">الحالة:</label>
            <select id="employeeDistributionStatusFilter" class="filter-select">
              <option value="" data-ar="جميع الحالات" data-en="All Cases">جميع الحالات</option>
              <option value="جديدة" data-ar="جديدة" data-en="New">جديدة</option>
              <option value="قيد المعالجة" data-ar="قيد المعالجة" data-en="In Progress">قيد المعالجة</option>
              <option value="تم الحل" data-ar="تم الحل" data-en="Resolved">تم الحل</option>
              <option value="مغلقة" data-ar="مغلقة" data-en="Closed">مغلقة</option>
            </select>
          </div>
          <div class="filter-group">
            <label data-ar="التوزيع:" data-en="Distribution:">التوزيع:</label>
            <select id="employeeDistributionAssignmentFilter" class="filter-select">
              <option value="" data-ar="جميع الشكاوى" data-en="All Complaints">جميع الشكاوى</option>
              <option value="assigned" data-ar="مخصصة" data-en="Assigned">مخصصة</option>
              <option value="unassigned" data-ar="غير مخصصة" data-en="Unassigned">غير مخصصة</option>
            </select>
          </div>
          <button onclick="loadEmployeeDistributionComplaints()" class="search-btn" data-ar="تحديث" data-en="Refresh">تحديث</button>
        </div>
        
        <table class="worklist-table">
          <thead>
            <tr>
              <th data-ar="رقم البلاغ" data-en="Report ID">رقم البلاغ</th>
              <th data-ar="اسم المريض" data-en="Patient Name">اسم المريض</th>
              <th data-ar="نوع البلاغ" data-en="Report Type">نوع البلاغ</th>
              <th data-ar="تاريخ الإنشاء" data-en="Created Date">تاريخ الإنشاء</th>
              <th data-ar="الحالة" data-en="Status">الحالة</th>
              <th data-ar="المسند إلى" data-en="Assigned To">المسند إلى</th>
              <th data-ar="الإجراءات" data-en="Actions">الإجراءات</th>
            </tr>
          </thead>
          <tbody id="employeeDistributionComplaintsTableBody">
            <!-- Employee distribution complaints data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Individual Assignment Modal (Admin Style) -->
  <div id="individualAssignmentModal" class="modal" style="z-index: 10000;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 data-ar="توزيع البلاغ" data-en="Assign Report">توزيع البلاغ</h2>
        <span class="close" onclick="closeModal('individualAssignmentModal')">&times;</span>
      </div>
      <div class="modal-body">
        <!-- Loading State -->
        <div id="assignmentLoading" class="loading-overlay" style="display: none;">
          <div class="loading-spinner"></div>
          <p data-ar="جاري تحميل الموظفين..." data-en="Loading employees...">جاري تحميل الموظفين...</p>
        </div>
        
        <div class="form-group">
          <label for="employeeSelect" data-ar="اختر موظف:" data-en="Select Employee:">اختر موظف:</label>
          <select id="employeeSelect" class="form-control">
            <option value="">اختر موظف...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="assignmentNotes" data-ar="ملاحظات (اختياري):" data-en="Notes (Optional):">ملاحظات (اختياري):</label>
          <textarea id="assignmentNotes" class="form-control" rows="3" placeholder="أضف ملاحظات حول التوزيع..."></textarea>
        </div>
        
        <div class="modal-actions">
          <button onclick="closeModal('individualAssignmentModal')" class="btn-cancel" data-ar="إلغاء" data-en="Cancel">إلغاء</button>
          <button onclick="assignComplaintToEmployee()" class="btn-confirm" data-ar="تأكيد التوزيع" data-en="Confirm Assignment">تأكيد التوزيع</button>
        </div>
      </div>
    </div>
  </div>

      <script src="./dept-admin.js"></script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-ar="الشكاوى المسندة - المدير" data-en="Assigned Complaints - Director">الشكاوى المسندة - المدير</title>

  <link rel="stylesheet" href="director-complaints.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand-deep:#172F4A;
      --brand-blue:#3BAAE0;
      --brand-muted:#6b7280;
      --card-bg:#ffffff;
      --card-border:#e5e7eb;
      --card-shadow:0 2px 10px rgba(0,0,0,.06);
      --soft-bg:#f8fafc;
      --badge-new:#dbeafe;
      --badge-pending:#fef3c7;
      --badge-done:#d1fae5;
      --danger:#dc2626;
      --primary:#2563eb;
      --radius:14px;
    }
    html,body{
      font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif!important;
      background:#f4f7fb; color:#111827;
    }

    .header{background:#fff;padding:15px 30px;box-shadow:0 2px 8px rgba(0,0,0,.1);border-bottom:1px solid #e9ecef;position:relative;z-index:1000}
    .header-content{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto}
    .header-title{font-size:24px;font-weight:bold;color:#1e88e5;margin:0}
    .header-logo{height:45px;width:auto}

    .main-content{max-width:1200px;margin:20px auto;padding:0 16px}

    .breadcrumb{display:flex;align-items:center;gap:8px;color:var(--brand-muted);margin-bottom:16px;font-size:.95rem}
    .breadcrumb a{color:var(--brand-deep);text-decoration:none;font-weight:600}
    .breadcrumb a:hover{text-decoration:underline}

    .page-header{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius);box-shadow:var(--card-shadow);padding:16px 18px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .page-title{display:flex;align-items:center;gap:10px}
    .page-title i{background:linear-gradient(135deg,var(--brand-deep),var(--brand-blue));color:#fff;width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 14px rgba(59,170,224,.25)}
    .page-title h1{font-size:1.1rem;margin:0}
    .page-actions .btn{min-width:140px}

    .back-button{display:flex;justify-content:space-between;align-items:center;margin:8px 0 16px}
    .back-button a{display:inline-flex;align-items:center;gap:8px;text-decoration:none;color:#4a5568;font-weight:700}
    .back-icon{width:20px;height:20px}

    .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;transition:.2s all;display:inline-flex;align-items:center;gap:8px}
    .btn-primary{background:var(--brand-blue);color:#fff}
    .btn-primary:hover{background:#2a9cd4}
    .btn-secondary{background:#eef2f7;color:#0f172a;border:1px solid #e5e7eb}
    .btn-secondary:hover{background:#e9eef5}
    .btn-sm{padding:7px 10px;font-size:.9rem}

    .filters-section{margin-bottom:16px}
    .filters-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius);box-shadow:var(--card-shadow);padding:16px}
    .filters-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .filters-header h3{font-size:1rem;margin:0;display:flex;align-items:center;gap:8px}
    .filters-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .filter-group label{display:block;margin-bottom:6px;color:#374151;font-weight:600}
    .filter-group select,.filter-group input{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;background:#fff;font-size:.95rem}
    .filter-group select:focus,.filter-group input:focus{outline:none;border-color:var(--brand-blue);box-shadow:0 0 0 3px rgba(59,170,224,.12)}

    .stats-section{margin-bottom:16px}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .stat-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;box-shadow:var(--card-shadow);padding:14px;display:flex;align-items:center;gap:12px;transition:transform .15s ease}
    .stat-card:hover{transform:translateY(-2px)}
    .stat-icon i{background:linear-gradient(135deg,var(--brand-deep),var(--brand-blue));color:#fff;width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 16px rgba(23,47,74,.22)}
    .stat-content h3{margin:0;font-size:1.3rem}
    .stat-content p{margin:2px 0 0;color:var(--brand-muted);font-weight:600}

    .complaints-section{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius);box-shadow:var(--card-shadow);padding:6px 6px 14px}
    .complaints-header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 10px 8px}
    .results-info{color:var(--brand-muted);font-weight:600}
    .sort-options{display:flex;align-items:center;gap:8px}
    .sort-options select{padding:8px 10px;border:1px solid #d1d5db;border-radius:8px;background:#fff}

    .complaints-list{display:flex;flex-direction:column;gap:10px;padding:0 6px}
    .complaint-card{border:1px solid var(--card-border);border-radius:12px;padding:12px;background:#fff;box-shadow:var(--card-shadow);display:grid;grid-template-columns:1fr auto;gap:12px}
    .complaint-main h4{margin:0 0 6px;font-size:1rem;color:#0f172a}
    .complaint-meta{display:flex;flex-wrap:wrap;gap:8px;color:#475569;font-size:.92rem}
    .badge{padding:4px 10px;border-radius:999px;font-weight:700;font-size:.8rem}
    .badge-new{background:var(--badge-new);color:#1e40af}
    .badge-pending{background:var(--badge-pending);color:#92400e}
    .badge-done{background:var(--badge-done);color:#065f46}
    .badge-danger{background:#fee2e2;color:#991b1b}

    .complaint-actions{display:flex;align-items:center;gap:8px}
    .complaint-actions .btn{padding:8px 10px;border-radius:8px}

    .pagination{margin-top:12px;display:flex;justify-content:center;gap:8px;flex-wrap:wrap}
    .pagination .page-btn{border:1px solid var(--card-border);background:#fff;border-radius:9px;padding:8px 12px;cursor:pointer;min-width:38px;text-align:center;transition:.15s}
    .pagination .page-btn.active{background:var(--brand-blue);color:#fff;border-color:var(--brand-blue)}
    .pagination .page-btn:hover{transform:translateY(-1px)}

    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000;align-items:center;justify-content:center;padding:10px}
    .modal-large .modal-content{max-width:850px}
    .modal-content{width:100%;max-width:520px;background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.25)}
    .modal-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--card-border);background:linear-gradient(135deg,var(--brand-deep),var(--brand-blue));color:#fff}
    .modal-header.error{background:linear-gradient(135deg,#7f1d1d,#dc2626)}
    .modal-body{padding:14px}
    .modal-footer{padding:12px 14px;border-top:1px solid var(--card-border);background:#fafafa;display:flex;gap:8px;justify-content:flex-end}
    .close-modal{background:transparent;border:none;color:#fff;font-size:1.1rem;cursor:pointer}
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="header-title" data-ar="بلاغات 937" data-en="Reports 937">بلاغات 937</div>
      <img src="/icon/hospital-logo.png" alt="شعار المستشفى" class="header-logo">
      <button id="toggleBtn" class="lang-toggle-btn">
        <img src="/icon/lang.png" alt="language" class="lang-icon" />
        <span id="langText">العربية | English</span>
      </button>
    </div>
  </header>

  <main class="main-content">
    <div class="page-header">
      <div class="page-title">
        <i class="fas fa-tasks"></i>
        <h1 data-ar="الشكاوى المسندة إليك" data-en="Complaints Assigned to You">الشكاوى المسندة إليك</h1>
      </div>
      <div class="page-actions">
        <button class="btn btn-primary" id="newComplaintBtn">
          <i class="fas fa-plus"></i>
          <span data-ar="بلاغ  جديدة" data-en="New Complaint">بلاغ  جديدة</span>
        </button>
      </div>
    </div>

    <div class="back-button">
      <nav class="breadcrumb">
        <a href="#" onclick="goBack()" data-ar="الصفحة الرئيسية" data-en="Home">
          <i class="fas fa-home"></i> الصفحة الرئيسية
        </a>
        <i class="fas fa-chevron-left"></i>
        <span data-ar="الشكاوى المسندة" data-en="Assigned Complaints">الشكاوى المسندة</span>
      </nav>
    </div>

    <div class="filters-section">
      <div class="filters-card">
        <div class="filters-header">
          <h3>
            <i class="fas fa-filter"></i>
            <span data-ar="تصفية النتائج" data-en="Filter Results">تصفية النتائج</span>
          </h3>
          <button class="btn btn-secondary btn-sm" id="clearFilters">
            <i class="fas fa-times"></i>
            <span data-ar="مسح الفلاتر" data-en="Clear Filters">مسح الفلاتر</span>
          </button>
        </div>
        <div class="filters-content">
          <div class="filter-group">
            <label for="statusFilter" data-ar="الحالة" data-en="Status">الحالة</label>
            <select id="statusFilter">
              <option value="" data-ar="جميع الحالات" data-en="All statuses">جميع الحالات</option>
              <option value="جديدة" data-ar="جديدة" data-en="New">جديدة</option>
              <option value="قيد المعالجة" data-ar="قيد المعالجة" data-en="In Progress">قيد المعالجة</option>
              <option value="قيد المراجعة" data-ar="قيد المراجعة" data-en="Under Review">قيد المراجعة</option>
              <option value="تم الحل" data-ar="تم الحل" data-en="Resolved">تم الحل</option>
              <option value="مغلقة" data-ar="مغلقة" data-en="Closed">مغلقة</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="priorityFilter" data-ar="الأولوية" data-en="Priority">الأولوية</label>
            <select id="priorityFilter">
              <option value="" data-ar="جميع الأولويات" data-en="All priorities">جميع الأولويات</option>
              <option value="عالية" data-ar="عالية" data-en="High">عالية</option>
              <option value="متوسطة" data-ar="متوسطة" data-en="Medium">متوسطة</option>
              <option value="منخفضة" data-ar="منخفضة" data-en="Low">منخفضة</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="searchInput" data-ar="البحث" data-en="Search">البحث</label>
            <input id="searchInput" type="text"
                   placeholder="ابحث في تفاصيل البلاغ ..."
                   data-ar-placeholder="ابحث في تفاصيل البلاغ ..."
                   data-en-placeholder="Search complaint details...">
          </div>
        </div>
      </div>
    </div>

    <div class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
          <div class="stat-content"><h3 id="totalCount">0</h3><p data-ar="إجمالي المسندة" data-en="Total Assigned">إجمالي المسندة</p></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-content"><h3 id="pendingCount">0</h3><p data-ar="قيد المعالجة" data-en="In Progress">قيد المعالجة</p></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
          <div class="stat-content"><h3 id="completedCount">0</h3><p data-ar="مكتملة" data-en="Completed">مكتملة</p></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
          <div class="stat-content"><h3 id="urgentCount">0</h3><p data-ar="عاجلة" data-en="Urgent">عاجلة</p></div>
        </div>
      </div>
    </div>

    <div class="complaints-section">
      <div class="complaints-header">
        <div class="results-info"><span id="resultsCount" data-ar="0 بلاغ " data-en="0 complaints">0 بلاغ </span></div>
        <div class="sort-options">
          <label for="sortBy" data-ar="ترتيب حسب:" data-en="Sort by:">ترتيب حسب:</label>
          <select id="sortBy">
            <option value="newest" data-ar="الأحدث" data-en="Newest">الأحدث</option>
            <option value="oldest" data-ar="الأقدم" data-en="Oldest">الأقدم</option>
            <option value="priority" data-ar="الأولوية" data-en="Priority">الأولوية</option>
            <option value="status" data-ar="الحالة" data-en="Status">الحالة</option>
          </select>
        </div>
      </div>

      <div class="complaints-list" id="complaintsList"></div>

      <div class="pagination" id="pagination"></div>
    </div>
  </main>

  <div class="loading-overlay" id="loadingOverlay" style="display:none;">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p data-ar="جاري تحميل الشكاوى..." data-en="Loading complaints...">جاري تحميل الشكاوى...</p>
    </div>
  </div>

  <div class="modal" id="errorModal">
    <div class="modal-content">
      <div class="modal-header error">
        <h3><i class="fas fa-exclamation-triangle"></i> <span data-ar="خطأ" data-en="Error">خطأ</span></h3>
        <button class="close-modal" id="closeErrorModal"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body"><p id="errorMessage" data-ar="حدث خطأ ما" data-en="Something went wrong">حدث خطأ ما</p></div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="closeErrorBtn"><span data-ar="حسناً" data-en="OK">حسناً</span></button>
      </div>
    </div>
  </div>

  <div class="modal modal-large" id="detailsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-file-alt"></i> <span data-ar="تفاصيل البلاغ " data-en="Complaint Details">تفاصيل البلاغ </span></h3>
        <button class="close-modal" id="closeDetailsModal"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body"><div id="complaintDetails"></div></div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="respondBtn"><span data-ar="إضافة رد" data-en="Add Response">إضافة رد</span></button>
        <button class="btn btn-secondary" id="updateStatusBtn"><span data-ar="تحديث الحالة" data-en="Update Status">تحديث الحالة</span></button>
        <button class="btn btn-secondary" id="closeDetailsBtn"><span data-ar="إغلاق" data-en="Close">إغلاق</span></button>
      </div>
    </div>
  </div>

  <div class="modal" id="responseModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-reply"></i> <span data-ar="إضافة رد" data-en="Add Response">إضافة رد</span></h3>
        <button class="close-modal" id="closeResponseModal"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="responseText" data-ar="الرد:" data-en="Response:">الرد:</label>
          <textarea id="responseText" rows="4"
                    placeholder="اكتب ردك هنا..."
                    data-ar-placeholder="اكتب ردك هنا..."
                    data-en-placeholder="Type your response here..."></textarea>
        </div>
        <div class="form-group">
          <label for="responseType" data-ar="نوع الرد:" data-en="Response Type:">نوع الرد:</label>
          <select id="responseType">
            <option value="رد رسمي" data-ar="رد رسمي" data-en="Official Reply">رد رسمي</option>
            <option value="اعتذار" data-ar="اعتذار" data-en="Apology">اعتذار</option>
            <option value="توضيح" data-ar="توضيح" data-en="Clarification">توضيح</option>
            <option value="متابعة" data-ar="متابعة" data-en="Follow-up">متابعة</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="submitResponseBtn"><span data-ar="إرسال الرد" data-en="Send Response">إرسال الرد</span></button>
        <button class="btn btn-secondary" id="cancelResponseBtn"><span data-ar="إلغاء" data-en="Cancel">إلغاء</span></button>
      </div>
    </div>
  </div>

  <div class="modal" id="statusModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-edit"></i> <span data-ar="تحديث الحالة" data-en="Update Status">تحديث الحالة</span></h3>
        <button class="close-modal" id="closeStatusModal"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="newStatus" data-ar="الحالة الجديدة:" data-en="New Status:">الحالة الجديدة:</label>
          <select id="newStatus">
            <option value="جديدة" data-ar="جديدة" data-en="New">جديدة</option>
            <option value="قيد المعالجة" data-ar="قيد المعالجة" data-en="In Progress">قيد المعالجة</option>
            <option value="قيد المراجعة" data-ar="قيد المراجعة" data-en="Under Review">قيد المراجعة</option>
            <option value="تم الحل" data-ar="تم الحل" data-en="Resolved">تم الحل</option>
            <option value="مغلقة" data-ar="مغلقة" data-en="Closed">مغلقة</option>
          </select>
        </div>
        <div class="form-group">
          <label for="statusRemarks" data-ar="ملاحظات:" data-en="Remarks:">ملاحظات:</label>
          <textarea id="statusRemarks" rows="3"
                    placeholder="أضف ملاحظات حول التحديث..."
                    data-ar-placeholder="أضف ملاحظات حول التحديث..."
                    data-en-placeholder="Add remarks about the update..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="submitStatusBtn"><span data-ar="تحديث الحالة" data-en="Update">تحديث الحالة</span></button>
        <button class="btn btn-secondary" id="cancelStatusBtn"><span data-ar="إلغاء" data-en="Cancel">إلغاء</span></button>
      </div>
    </div>
  </div>

  <script src="director-complaints.js"></script>

  <script>
    (function () {
      function applyLanguage(lang){
        document.documentElement.lang = lang;
        document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.querySelectorAll('[data-ar]').forEach(el=>{
          el.textContent = el.getAttribute(lang==='ar'?'data-ar':'data-en') || el.textContent;
        });
        document.querySelectorAll('[data-ar-placeholder]').forEach(el=>{
          el.placeholder = el.getAttribute(lang==='ar'?'data-ar-placeholder':'data-en-placeholder') || el.placeholder;
        });
        const t = document.getElementById('langText');
        if (t) t.textContent = lang==='ar' ? 'العربية | English' : 'English | العربية';
      }
      let lang = localStorage.getItem('lang') || 'ar';
      applyLanguage(lang);
      document.getElementById('toggleBtn')?.addEventListener('click', ()=>{
        lang = lang === 'ar' ? 'en' : 'ar';
        localStorage.setItem('lang', lang);
        applyLanguage(lang);
      });
      window.goBack = function(){
        if (history.length > 1) history.back();
        else window.location.href = 'director-dashboard.html';
      };
    })();
  </script>
</body>
</html>

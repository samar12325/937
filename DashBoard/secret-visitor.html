<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Tailwind CSS CDN -->
            <link rel="stylesheet" href="secret-visitor.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Inter, Tajawal, and Merriweather -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- SheetJS Library for Excel file reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* Export styles */
        .exporting .no-export {
            display: none !important;
        }
        
        .exporting {
            background: white !important;
        }
        
        .exporting * {
            color: black !important;
            background: white !important;
        }
        
        .exporting canvas {
            background: white !important;
        }
        
        @media print {
            .no-export {
                display: none !important;
            }
        }
    </style>
    
    <!-- Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¨Ø´ÙƒÙ„ Ù‚Ø§Ø·Ø¹ -->
    <style>
        /* Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù */
        .menu-add, .menu-edit, .menu-delete,
        .action-add, .action-edit, .action-delete,
        #btnAdd, #btnEdit, #btnDelete,
        #btnAddDepartment, #btnEditDepartment, #btnDeleteDepartment,
        .dropdown-menu .add-item,
        .dropdown-menu .edit-item,
        .dropdown-menu .delete-item,
        .action-btn.edit-btn,
        .action-btn.delete-btn,
        .action-buttons,
        .add-section-option,
        [data-permission="add_department"],
        [data-permission="edit_department"],
        [data-permission="delete_department"] {
            display: none !important;
        }
    </style>
  
</head>
<body class="flex h-screen overflow-hidden lang-ar">

    <!-- Header (User-provided HTML) -->
    <header class="header">
        <div class="header-content">
            <!-- Placeholder for hospital-logo.png -->   
            <div class="header-title" data-ar="Ø¨Ù„Ø§ØºØ§Øª 937" data-en="Reports 937">Ø¨Ù„Ø§ØºØ§Øª 937</div>
            <img src="/icon/hospital-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰" class="header-logo">

            <button id="langToggle" class="lang-toggle-btn">
                <!-- Placeholder for lang.png -->
                <img src="/icon/lang.png" alt="language" class="lang-icon" />
                <span id="langText">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© | English</span>
            </button>
        </div>
    </header>

    <!-- Sidebar (User-provided HTML) -->
    <aside>
        <ul class="sidebar-menu">
            <li><a href="/login/login.html" class="menu-link" data-ar="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home Page">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="overview.html" class="menu-link" data-ar="Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©" data-en="Overview">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</a></li>
            <li><a href="report-937.html" class="menu-link " data-ar="Ù…Ø¤Ø´Ø± Ø¨Ù„Ø§ØºØ§Øª 937" data-en="937 Report Index">Ù…Ø¤Ø´Ø± Ø¨Ù„Ø§ØºØ§Øª 937</a></li> <!-- Active link changed -->
            <li><a href="misconduct.html" class="menu-link" data-ar="Ø¨Ù„Ø§ØºØ§Øª Ø³ÙˆØ¡ Ø§Ù„ØªØ¹Ø§Ù…Ù„" data-en="Misconduct Reports">Ø¨Ù„Ø§ØºØ§Øª Ø³ÙˆØ¡ Ø§Ù„ØªØ¹Ø§Ù…Ù„</a></li>
            <li><a href="pressganey.html" class="menu-link" data-ar="Ù…Ø¤Ø´Ø± Ø¨Ø±Ø³Ø¬ÙŠÙ†ÙŠ" data-en="Press Ganey Index">Ù…Ø¤Ø´Ø± Ø¨Ø±Ø³Ø¬ÙŠÙ†ÙŠ</a></li>
            <li><a href="inperson-complaints.html" class="menu-link" data-ar="Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±ÙŠØ©" data-en="In-person Complaints">Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±ÙŠØ©</a></li>
            <li><a href="secret-visitor.html" class="menu-link active" data-ar="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ" data-en="Secret Visitor Notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ</a></li>
            <li><a href="general-requests.html" class="menu-link" data-ar="Ù…Ø¤Ø´Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©" data-en="General Requests Index">Ù…Ø¤Ø´Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</a></li>
        </ul>
    </aside>

    <!-- Main Content Area -->
    <div id="exportArea" class="flex-1 flex flex-col p-8 overflow-auto" style="margin-right: 250px; margin-top: 75px;">
        
        <!-- Ø´Ø±ÙŠØ· ØªØ­ÙƒÙ…: Ø²Ø± Ø§Ø³ØªÙŠØ±Ø§Ø¯ + Ø²Ø± Ø­ÙØ¸ + Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± -->
        <div class="flex flex-wrap gap-3 items-center justify-center mb-6">
            <input id="excelInput" type="file" multiple accept=".xlsx,.xls" class="hidden">
            <button id="importExcelBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-5 rounded-full shadow flex items-center">
                <i class="fas fa-file-excel ml-2"></i>
                <span data-ar="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª Ø¥ÙƒØ³Ù„" data-en="Import Excel Files">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª Ø¥ÙƒØ³Ù„</span>
            </button>



            <button id="saveToServerBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-5 rounded-full shadow flex items-center">
                <i class="fas fa-save ml-2"></i>
                <span data-ar="Ø­ÙØ¸ (Ù…Ø­Ù„ÙŠÙ‹Ø§)" data-en="Save (Local)">Ø­ÙØ¸ (Ù…Ø­Ù„ÙŠÙ‹Ø§)</span>
            </button>
        </div>



        <!-- Top Cards Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Card 1: Total Observation Locations -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-2" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª" data-en="Total Observation Locations">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
                <p class="text-4xl font-bold text-blue-600" id="totalObservationLocations">5</p>
            </div>
            <!-- Card 2: Total Responsible Departments -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-2" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©" data-en="Total Responsible Departments">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©</p>
                <p class="text-4xl font-bold text-green-600" id="totalResponsibleDepartments">13</p>
            </div>
            <!-- Card 3: Total Secret Visitor Notes -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-2" data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ" data-en="Total Secret Visitor Notes">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ</p>
                <p class="text-4xl font-bold text-purple-600" id="totalSecretVisitorNotes">44</p>
            </div>
        </div>

        <!-- Dropdown Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800" data-ar="Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„Ù‡" data-en="Choose Department to View Details">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„Ù‡</h3>
            </div>
            <div class="custom-select-wrapper">
                <div class="custom-select" id="departmentSelect">
                    <input type="text" id="departmentSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø³Ù…..." 
                           data-ar="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø³Ù…..." data-en="Search for department..." 
                           class="department-search-input" style="border: none; outline: none; background: transparent; width: 100%;">
                    <span id="selectedDepartment" data-ar="Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù„Ù‚Ø³Ù…" data-en="Choose Department/Section" style="display: none;">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù„Ù‚Ø³Ù…</span>
                    <i class="fas fa-chevron-down text-gray-500"></i>
                </div>
                <div class="custom-select-options" id="departmentOptions">
                    <div class="custom-select-option" data-value="all" data-ar="Ø§Ù„ÙƒÙ„" data-en="All">Ø§Ù„ÙƒÙ„</div>
                    <!-- All departments will be populated dynamically by JavaScript with edit/delete buttons -->
                    <div class="custom-select-divider"></div>
                    <div class="custom-select-option add-section-option" data-value="add-section" data-ar="Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯" data-en="Add New Section">
                        <i class="fas fa-plus ml-2"></i>
                        <span data-ar="Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯" data-en="Add New Section">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Left Chart: Horizontal Bar Chart -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°" data-en="Secret Visitor Notes by Department and Execution Status">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°</h2>
                <div class="flex justify-center items-center mb-4">
                    <div class="flex items-center ml-4">
                        <span class="w-4 h-4 rounded-full bg-green-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" data-ar="Ù…Ù†ÙØ°" data-en="Executed">Ù…Ù†ÙØ°</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-4 h-4 rounded-full bg-red-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" data-ar="ØºÙŠØ± Ù…Ù†ÙØ°" data-en="Not Executed">ØºÙŠØ± Ù…Ù†ÙØ°</span>
                    </div>
                </div>
                <div class="relative w-full" style="height: 350px;">
                    <canvas id="horizontalBarChart"></canvas>
                </div>
            </div>

                         <!-- Right Chart: Donut Chart -->
             <div class="bg-white rounded-lg shadow-md p-6">
                 <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…" data-en="Secret Visitor Notes by Department">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø§Ù„Ø³Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</h2>
                <div class="relative w-full" style="height: 350px;">
                    <canvas id="donutChart"></canvas>
                </div>
                <!-- Donut Chart Legend (Custom HTML, Chart.js legend disabled) -->
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-blue-600 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="dental-center-legend" data-ar="Ù…Ø±ÙƒØ² Ø§Ù„Ø§Ø³Ù†Ø§Ù†" data-en="Dental Center">Ù…Ø±ÙƒØ² Ø§Ù„Ø§Ø³Ù†Ø§Ù†</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-red-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="emergency-legend" data-ar="Ø§Ù„Ø·ÙˆØ§Ø±Ø¦" data-en="Emergency">Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-gray-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="corridors-legend" data-ar="Ø§Ù„Ù…Ù…Ø±Ø§Øª" data-en="Corridors">Ø§Ù„Ù…Ù…Ø±Ø§Øª</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-green-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="outpatient-legend" data-ar="Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©" data-en="Outpatient Clinics">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-purple-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="inpatient-legend" data-ar="Ø§Ù„ØªÙ†ÙˆÙŠÙ…" data-en="Inpatient">Ø§Ù„ØªÙ†ÙˆÙŠÙ…</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù…Ù† Excel (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
        <div id="excelDataTableContainer" class="bg-white rounded-lg shadow-md p-6 mb-8 hidden">
            <h3 class="text-lg font-semibold text-gray-800 mb-4" data-ar="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±" data-en="Selected Department Data">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±</h3>
            <div class="overflow-x-auto">
                <table id="excelDataTable" class="min-w-full bg-white border border-gray-300">
                    <thead class="bg-gray-50">
                        <tr>
                                                         <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="Ø§Ù„Ù‚Ø³Ù…" data-en="Department" id="mainDeptHeader">Ø§Ù„Ù‚Ø³Ù…</th>
                                                         <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©" data-en="Notes" id="mainNoteHeader">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                             <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©" data-en="Responsible Department" id="mainRespDeptHeader">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©</th>
                             <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°" data-en="Execution Status" id="mainStatusHeader">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°</th>
                             <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" data-en="Actions" id="mainActionsHeader">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="excelDataTableBody" class="bg-white">
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500" data-ar="Ø§Ø®ØªØ± Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡" data-en="Select a department from the list above to view its data">Ø§Ø®ØªØ± Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
        <div class="flex justify-center gap-4 mt-8 no-export">
            <button id="exportReportBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center permission-gated" data-permission="reports_export" style="display: none;">
                <i class="fas fa-file-pdf ml-2"></i>
                <span data-ar="ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±" data-en="Export PDF">ØªØµØ¯ÙŠØ± PDF</span>
            </button>
            
            <button id="exportExcelBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center permission-gated" data-permission="reports_export" style="display: none;">
                <i class="fas fa-file-excel ml-2"></i>
                <span data-ar="ØªØµØ¯ÙŠØ± Excel" data-en="Export Excel">ØªØµØ¯ÙŠØ± Excel</span>
            </button>

            <!-- Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ -->
            <button id="exportSecretVisitorPdfBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
                <i class="fas fa-file-signature ml-2"></i>
                <span data-ar="ØªØµØ¯ÙŠØ± PDF " data-en="Export Pro PDF">ØªØµØ¯ÙŠØ± PDF </span>
            </button>
        </div>
    </div>



    <!-- AI Insights Modal -->
    <div id="aiInsightsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full mx-4 relative modal-content">
            <button id="closeModalBtn" class="absolute top-4 left-4 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            <h3 class="text-xl font-semibold text-gray-800 mb-4" data-ar="Ø±Ø¤Ù‰ ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ" data-en="AI Insights and Analysis">Ø±Ø¤Ù‰ ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
            <div id="aiInsightsContent" class="text-gray-700 text-base leading-relaxed">
                <!-- AI generated content will be loaded here -->
                <div id="aiLoadingSpinner" class="flex justify-center items-center py-8 hidden">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ -->
    <div id="addDepartmentModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-ar="Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯" data-en="Add New Department">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeAddDepartmentModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addDepartmentForm">
                    <div class="form-group">
                        <label for="departmentKey" data-ar="Ù…ÙØªØ§Ø­ Ø§Ù„Ù‚Ø³Ù… (ÙØ±ÙŠØ¯)" data-en="Department Key (Unique)">Ù…ÙØªØ§Ø­ Ø§Ù„Ù‚Ø³Ù… (ÙØ±ÙŠØ¯)</label>
                        <input type="text" id="departmentKey" name="departmentKey" required 
                               placeholder="Ù…Ø«Ø§Ù„: new-department" pattern="[a-z0-9-_]+" title="ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù ØµØºÙŠØ±Ø© ÙˆØ£Ø±Ù‚Ø§Ù… ÙˆØ´Ø±Ø·Ø§Øª ÙÙ‚Ø·">
                    </div>
                    <div class="form-group">
                        <label for="departmentNameAr" data-ar="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)" data-en="Department Name (Arabic)">Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)</label>
                        <input type="text" id="departmentNameAr" name="departmentNameAr" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
                    </div>
                    <div class="form-group">
                        <label for="departmentNameEn" data-ar="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)" data-en="Department Name (English)">Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                        <input type="text" id="departmentNameEn" name="departmentNameEn" required 
                               placeholder="Enter department name in English">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddDepartmentModal()" 
                        data-ar="Ø¥Ù„ØºØ§Ø¡" data-en="Cancel">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-primary" onclick="saveNewDepartment()" 
                        data-ar="Ø­ÙØ¸" data-en="Save">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Modal Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <div id="manageDepartmentsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 data-ar="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…" data-en="Manage Departments">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
                <button class="modal-close" onclick="closeManageDepartmentsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 border-b border-gray-200 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ</th>
                                <th class="px-4 py-3 border-b border-gray-200 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</th>
                                <th class="px-4 py-3 border-b border-gray-200 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ù…ÙØªØ§Ø­</th>
                                <th class="px-4 py-3 border-b border-gray-200 text-right text-xs font-medium text-gray-500 uppercase">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="departmentsTableBody">
                            <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù‡Ù†Ø§ -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeManageDepartmentsModal()" 
                        data-ar="Ø¥ØºÙ„Ø§Ù‚" data-en="Close">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Modal ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø³Ù… -->
    <div id="editSectionModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-ar="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…" data-en="Edit Section">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…</h3>
                <button class="modal-close" onclick="closeEditSectionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editSectionForm">
                    <input type="hidden" id="editSectionId">
                    <div class="form-group">
                        <label for="editSectionNameAr" data-ar="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)" data-en="Section Name (Arabic)">Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¹Ø±Ø¨ÙŠ)</label>
                        <input type="text" id="editSectionNameAr" name="sectionNameAr" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
                    </div>
                    <div class="form-group">
                        <label for="editSectionNameEn" data-ar="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)" data-en="Section Name (English)">Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                        <input type="text" id="editSectionNameEn" name="sectionNameEn" required 
                               placeholder="Enter section name in English">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded" onclick="closeEditSectionModal()">
                    <span data-ar="Ø¥Ù„ØºØ§Ø¡" data-en="Cancel">Ø¥Ù„ØºØ§Ø¡</span>
                </button>
                <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="updateSection()">
                    <span data-ar="Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª" data-en="Save Changes">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span>
                </button>
            </div>
        </div>
    </div>

    <style>
        /* Department Dropdown Action Buttons */
        .custom-select-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .custom-select-option:hover {
            background-color: #f3f4f6;
        }

        .department-name {
            flex: 1;
            margin-right: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .custom-select-option:hover .action-buttons {
            opacity: 1;
        }

        .action-btn {
            padding: 4px 6px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }

        .edit-btn {
            background-color: #3b82f6;
            color: white;
        }

        .edit-btn:hover {
            background-color: #2563eb;
        }

        .delete-btn {
            background-color: #ef4444;
            color: white;
        }

        .delete-btn:hover {
            background-color: #dc2626;
        }

        .add-section-option {
            background-color: #f0f9ff;
            border-top: 1px solid #e5e7eb;
            font-weight: 500;
        }

        .add-section-option:hover {
            background-color: #e0f2fe;
        }

        .custom-select-divider {
            height: 1px;
            background-color: #e5e7eb;
            margin: 4px 0;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background-color: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid #e5e7eb;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
    </style>
<script>
  (function () {
    // Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ù†ÙØ³ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø¹Ù†Ø¯Ùƒ: localStorage.user ÙŠØ­ØªÙˆÙŠ RoleID
    function redirectByRole() {
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (!user) return '/login/login.html';

      const roleId = Number(user.RoleID || user.roleId);
      if (roleId === 1) return '/superadmin/superadmin-home.html'; // Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†
      if (roleId === 2) return '/employee/employee-home.html';   // Ù…ÙˆØ¸Ù
      if (roleId === 3) return '/dept-admin/dept-admin.html';      // Ø£Ø¯Ù…Ù†
      return '/login/login.html'; // Ø§Ø­ØªÙŠØ§Ø·ÙŠ
    }

    // ÙƒÙ„ Ø±ÙˆØ§Ø¨Ø· "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
    const homeLinks = document.querySelectorAll(
      'aside .sidebar-menu a.menu-link[href$="/login/login.html"], aside .sidebar-menu a.menu-link[data-en="Home Page"], aside .sidebar-menu a.menu-link[data-ar="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"]'
    );

    homeLinks.forEach(a => {
      // Ø®ÙÙ„Ù‘ÙŠ Ø§Ù„Ù†Ù‚Ø± ÙŠÙˆØ¬Ù‘Ù‡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
      a.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = redirectByRole();
      });

      // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¹Ø¯Ù‘Ù„ÙŠ Ø§Ù„Ù€ href Ø§Ù„Ø¸Ø§Ù‡Ø± Ù„Ù„Ù€ Hover/Copy
      a.setAttribute('href', redirectByRole());
    });
  })();
</script>

<!-- jsPDF + html2canvas (Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <script src="secret-visitor.js"></script>
    
    <!-- Ø¥Ø²Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const kill = (sel) => document.querySelectorAll(sel).forEach(el => el.remove());

            // 1) Ø§Ø­Ø°Ù Ø¨Ø§Ù„Ù€ selectors Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
            [
                '.menu-add', '.menu-edit', '.menu-delete',
                '.action-add', '.action-edit', '.action-delete',
                '#btnAdd', '#btnEdit', '#btnDelete',
                '#btnAddDepartment', '#btnEditDepartment', '#btnDeleteDepartment',
                '.dropdown-menu .add-item',
                '.dropdown-menu .edit-item',
                '.dropdown-menu .delete-item',
                '.action-btn.edit-btn',
                '.action-btn.delete-btn',
                '.action-buttons',
                '.add-section-option',
                // 2) Ø§Ø­Ø°Ù Ø¨Ø­Ø³Ø¨ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©
                '[data-permission="add_department"]',
                '[data-permission="edit_department"]',
                '[data-permission="delete_department"]'
            ].forEach(kill);

            // 3) ÙÙ„ØªØ± Ø¨Ø§Ù„Ù†Øµ (Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)
            const textMatch = /(Ø¥Ø¶Ø§ÙØ©|ØªØ¹Ø¯ÙŠÙ„|Ø­Ø°Ù|Add|Edit|Delete)/i;
            document.querySelectorAll('button, a, li, div').forEach(el => {
                const t = (el.textContent || '').trim();
                if (textMatch.test(t) && (
                    t.includes('Ù‚Ø³Ù…') || t.includes('department') || 
                    t.includes('section') || t.includes('Ø¥Ø¯Ø§Ø±Ø©')
                )) {
                    el.remove();
                }
            });

            // 4) Ù„Ùˆ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ¨Ù†Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹ (SPA)ØŒ Ø±Ø§Ù‚ÙØ¨ DOM Ù„Ø­Ø°Ù Ø£ÙŠ Ø²Ø± Ø¬Ø¯ÙŠØ¯
            const mo = new MutationObserver(() => {
                [
                    '.menu-add', '.menu-edit', '.menu-delete',
                    '.action-add', '.action-edit', '.action-delete',
                    '.action-btn.edit-btn',
                    '.action-btn.delete-btn',
                    '.action-buttons',
                    '.add-section-option',
                    '[data-permission="add_department"]',
                    '[data-permission="edit_department"]',
                    '[data-permission="delete_department"]'
                ].forEach(kill);
                
                // ÙÙ„ØªØ± Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                document.querySelectorAll('button, a, li, div').forEach(el => {
                    const t = (el.textContent || '').trim();
                    if (textMatch.test(t) && (
                        t.includes('Ù‚Ø³Ù…') || t.includes('department') || 
                        t.includes('section') || t.includes('Ø¥Ø¯Ø§Ø±Ø©')
                    )) {
                        el.remove();
                    }
                });
            });
            
            mo.observe(document.body, { childList: true, subtree: true });
            
            console.log('ğŸ”’ ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ù…Ù† secret-visitor.html');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مؤشر الطلبات العامة</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="general-requests.css">
    <!-- Google Fonts for Inter, Tajawal, and Merriweather -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- PDF libraries -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    
    <style>
        @media print {
            @page { size: A4 landscape; margin: 10mm; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>

</head>
<body class="flex h-screen overflow-hidden lang-ar">

    <!-- Header (User-provided HTML) -->
    <header class="header">
        <div class="header-content">
            <!-- Placeholder for hospital-logo.png -->   
            <div class="header-title" data-ar="بلاغات 937" data-en="AOUNAK">عُــــــونَك</div>
            <img src="/icon/hospital-logo.png" alt="شعار المستشفى" class="header-logo">

            <button id="langToggle" class="lang-toggle-btn">
                <!-- Placeholder for lang.png -->
                <img src="/icon/lang.png" alt="language" class="lang-icon" />
                <span id="langText">العربية | English</span>
            </button>
        </div>
    </header>

    <!-- Sidebar (User-provided HTML) -->
   <br><br> 
    <aside>
        <ul class="sidebar-menu">
            <li><a href="/login/login.html" class="menu-link" data-ar="الصفحة الرئيسية" data-en="Home Page">الصفحة الرئيسية</a></li>
            <li><a href="overview.html" class="menu-link" data-ar="نظرة عامة" data-en="Overview">نظرة عامة</a></li>
            <li><a href="report-937.html" class="menu-link " data-ar="مؤشر بلاغات 937" data-en="937 Report Index">مؤشر بلاغات 937</a></li> <!-- Active link changed -->
            <li><a href="misconduct.html" class="menu-link" data-ar="بلاغات سوء التعامل" data-en="Misconduct Reports">بلاغات سوء التعامل</a></li>
            <li><a href="pressganey.html" class="menu-link" data-ar="مؤشر برسجيني " data-en="Press Ganey Index">مؤشر برسجيني </a></li>
            <li><a href="inperson-complaints.html" class="menu-link" data-ar="مؤشر البلاغات الحضورية" data-en="In-person Complaints">مؤشر البلاغات الحضورية</a></li>
            <li><a href="secret-visitor.html" class="menu-link" data-ar="ملاحظات الزائر السري" data-en="Secret Visitor Notes">ملاحظات الزائر السري</a></li>
            <li><a href="general-requests.html" class="menu-link active" data-ar="مؤشر الطلبات العامة" data-en="General Requests Index">مؤشر الطلبات العامة</a></li>
        </ul>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col p-8 overflow-auto" style="margin-right: 250px; margin-top: 75px;">
        <!-- Chart Section -->
        <div class="bg-white rounded-lg shadow-md p-6 flex-1">
            <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="الطلبات العامة المنفذة وغير المنفذة حسب النوع" data-en="Fulfilled and Unfulfilled General Requests by Type">الطلبات العامة المنفذة وغير المنفذة حسب النوع</h2>

            <!-- Chart Legend -->
            <div class="flex justify-center items-center mb-8">
                <div class="flex items-center ml-4">
                    <span class="w-4 h-4 rounded-full bg-red-500 ml-2"></span>
                    <span class="text-gray-700 text-sm" data-ar="غير منفذ" data-en="Unfulfilled">غير منفذ</span>
                </div>
                <div class="flex items-center">
                    <span class="w-4 h-4 rounded-full bg-green-500 ml-2"></span>
                    <span class="text-gray-700 text-sm" data-ar="منفذ" data-en="Fulfilled">منفذ</span>
                </div>
            </div>

            <!-- Chart.js Canvas -->
            <div class="relative w-full" style="height: 350px;">
                <canvas id="generalRequestsChart" style="width: 100%; height: 350px; max-width: 100%; max-height: 350px;"></canvas>
            </div>

            <!-- Buttons for Export Report and AI Insights -->
            <div class="flex justify-center mt-8 space-x-4 space-x-reverse"> <!-- space-x-reverse for RTL spacing -->
                <button id="checkDataBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
                    <i class="fas fa-search ml-2"></i>
                    <span data-ar="فحص البيانات" data-en="Check Data">فحص البيانات</span>
                </button>
                <button id="addRequestBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
                    <i class="fas fa-plus ml-2"></i>
                    <span data-ar="إضافة طلب جديد" data-en="Add New Request">إضافة طلب جديد</span>
                </button>
                <button id="exportReportBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
                    <i class="fas fa-download ml-2"></i>
                    <span data-ar="تصدير التقرير" data-en="Export Report">تصدير التقرير</span>
                </button>
                
                <!-- زر التصدير الاحترافي -->
                <button id="exportGeneralRequestsPdfBtn" type="button"
                  class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
                  <i class="fas fa-file-signature ml-2"></i>
                  <span data-ar="تصدير PDF " data-en="Export Pro PDF">تصدير PDF </span>
                </button>
            </div>
        </div>
    </div>
<script>
  (function () {
    // استخدمي نفس التخزين عندك: localStorage.user يحتوي RoleID
    function redirectByRole() {
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (!user) return '/login/login.html';
      const roleId = Number(user.RoleID || user.roleId);
      if (roleId === 1) return '/superadmin/superadmin-home.html'; // سوبر أدمن
      if (roleId === 2) return '/employee/employee-home.html';   // موظف
      if (roleId === 3) return '/dept-admin/dept-admin.html';  
      return '/login/login.html'; // احتياطي
    }

    // كل روابط "الصفحة الرئيسية" الموجودة في الشريط الجانبي
    const homeLinks = document.querySelectorAll(
      'aside .sidebar-menu a.menu-link[href$="/login/login.html"], aside .sidebar-menu a.menu-link[data-en="Home Page"], aside .sidebar-menu a.menu-link[data-ar="الصفحة الرئيسية"]'
    );

    homeLinks.forEach(a => {
      // خَلّي النقر يوجّه حسب الدور
      a.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = redirectByRole();
      });

      // (اختياري) عدّلي الـ href الظاهر للـ Hover/Copy
      a.setAttribute('href', redirectByRole());
    });
  })();
</script>
    <script src="general-requests.js"></script>
    
    <style>
        /* إجبار النوافذ المنبثقة على أن تكون كبيرة جداً */
        .modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: rgba(0, 0, 0, 0.5) !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            z-index: 1000 !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .modal-content {
            background: white !important;
            border-radius: 12px !important;
            width: 99vw !important;
            max-width: none !important;
            height: 99vh !important;
            max-height: none !important;
            overflow-y: auto !important;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* تحسين الجداول */
        .modal-content table {
            width: 100% !important;
            font-size: 28px !important;
        }

        .modal-content th,
        .modal-content td {
            padding: 35px 30px !important;
            font-size: 28px !important;
        }

        .modal-content th {
            font-size: 30px !important;
        }

        /* تحسين النماذج */
        .modal-content input {
            padding: 30px !important;
            font-size: 24px !important;
        }

        .modal-content label {
            font-size: 24px !important;
        }

        .modal-content h3 {
            font-size: 32px !important;
        }

        .modal-content .btn {
            padding: 25px 50px !important;
            font-size: 22px !important;
        }

        /* إجبار إضافي للنوافذ المنبثقة */
        .modal[style*="display: flex"] {
            width: 100vw !important;
            height: 100vh !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .modal[style*="display: flex"] .modal-content {
            width: 99vw !important;
            height: 99vh !important;
            max-width: none !important;
            max-height: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* تحسين إضافي للجداول */
        .modal-content table {
            font-size: 32px !important;
        }

        .modal-content th,
        .modal-content td {
            padding: 40px 35px !important;
            font-size: 32px !important;
        }

        .modal-content th {
            font-size: 34px !important;
        }

        /* تحسين إضافي للنماذج */
        .modal-content input {
            padding: 35px !important;
            font-size: 28px !important;
        }

        .modal-content label {
            font-size: 28px !important;
        }

        .modal-content h3 {
            font-size: 36px !important;
        }

        .modal-content .btn {
            padding: 30px 60px !important;
            font-size: 26px !important;
        }

        /* إجبار إضافي قوي جداً للنوافذ المنبثقة */
        .modal[style*="display: flex"] {
            width: 100vw !important;
            height: 100vh !important;
            padding: 0 !important;
            margin: 0 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
        }

        .modal[style*="display: flex"] .modal-content {
            width: 99.5vw !important;
            height: 99.5vh !important;
            max-width: none !important;
            max-height: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* تحسين إضافي للجداول */
        .modal-content table {
            font-size: 36px !important;
        }

        .modal-content th,
        .modal-content td {
            padding: 45px 40px !important;
            font-size: 36px !important;
        }

        .modal-content th {
            font-size: 38px !important;
        }

        /* تحسين إضافي للنماذج */
        .modal-content input {
            padding: 40px !important;
            font-size: 32px !important;
        }

        .modal-content label {
            font-size: 32px !important;
        }

        .modal-content h3 {
            font-size: 40px !important;
        }

        .modal-content .btn {
            padding: 35px 70px !important;
            font-size: 30px !important;
        }

        /* إجبار جميع النوافذ المنبثقة */
        div[class*="modal"] {
            width: 100vw !important;
            height: 100vh !important;
        }

        div[class*="modal-content"] {
            width: 99.5vw !important;
            height: 99.5vh !important;
            max-width: none !important;
            max-height: none !important;
        }
    </style>
    
    <script>
        // إجبار النوافذ المنبثقة على أن تكون كبيرة
        function makeModalsLarge() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.width = '100vw';
                modal.style.height = '100vh';
                modal.style.padding = '0';
                modal.style.margin = '0';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    modalContent.style.width = '99.5vw';
                    modalContent.style.height = '99.5vh';
                    modalContent.style.maxWidth = 'none';
                    modalContent.style.maxHeight = 'none';
                    modalContent.style.margin = '0';
                    modalContent.style.padding = '0';
                }
            });
        }

        // إجبار جميع النوافذ المنبثقة على أن تكون كبيرة
        function forceAllModalsLarge() {
            const allModals = document.querySelectorAll('div[class*="modal"]');
            allModals.forEach(modal => {
                modal.style.width = '100vw';
                modal.style.height = '100vh';
                modal.style.padding = '0';
                modal.style.margin = '0';
                
                const modalContent = modal.querySelector('div[class*="modal-content"]');
                if (modalContent) {
                    modalContent.style.width = '99.5vw';
                    modalContent.style.height = '99.5vh';
                    modalContent.style.maxWidth = 'none';
                    modalContent.style.maxHeight = 'none';
                    modalContent.style.margin = '0';
                    modalContent.style.padding = '0';
                }
            });
        }

        // تطبيق التغييرات عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            makeModalsLarge();
            forceAllModalsLarge();
            
            // مراقبة إضافة عناصر جديدة
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        makeModalsLarge();
                        forceAllModalsLarge();
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });

        // إجبار النوافذ على أن تكون كبيرة عند فتحها
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
                makeModalsLarge();
                forceAllModalsLarge();
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // إجبار النوافذ على أن تكون كبيرة كل ثانية
        setInterval(function() {
            makeModalsLarge();
            forceAllModalsLarge();
        }, 1000);
    </script>
</body>
</html>
